(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{2273:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(4),a=n(8),i=n(7),r=n(5),s=n(6),c=n(0),l=n(1),m=n(115),u=(n(2307),function(e){function t(){return Object(o.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e=this.props.onRef;return Object(c.b)("div",{className:"Comments-pattern-loading",ref:e},Object(c.b)(m.a,null))}}]),t}(l.PureComponent))},2274:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(3);function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.selectedKey,i=void 0===a?"selectedProps":a,r=n.dropedKey,s=void 0===r?"dropedProps":r;return Object.keys(e).reduce(function(n,a){var r=t.includes(a)?i:s;return Object.assign({},n,Object(o.a)({},r,Object.assign({},n[r],Object(o.a)({},a,e[a]))))},{})}},2282:function(e,t,n){"use strict";var o=n(4),a=n(8),i=n(7),r=n(5),s=n(6),c=n(10),l=n(1),m=n(19),u=n.n(m),d=n(9),p=n(0),b=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).handleClick=function(){var e=n.props;(0,e.onSelect)(e.page)},n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return Object(p.b)(d.c,{preset:d.b.Plain,className:u()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),t}(l.Component),h=(n(2306),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},function(t,n){return n+e})}),f=function(e){function t(){return Object(o.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.onSelect,o=t.className,a=t.clickCallback,i=this.props.current,r=this.props.total,s=a&&(e=a,function(){e.apply(void 0,arguments)})||n,l=function(e,t){var n="...";return t<=5?h(1,t):e>t-3?[1,n].concat(Object(c.a)(h(t-3,3)),[t]):e<=3?[1].concat(Object(c.a)(h(2,3)),[n,t]):[1,n].concat(Object(c.a)(h(e-Math.floor(1.5),3)),[n,t])}(i,r);return Object(p.b)("div",{className:u()("Pagination",o)},i>1&&i<=r&&Object(p.b)(b,{className:"PaginationButton-prev",onSelect:s,text:"上一页",page:i-1}),l.map(function(e,t){return"number"==typeof e?Object(p.b)(b,{onSelect:s,text:e,page:e,key:t,isCurrent:i===e}):Object(p.b)("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)}),i>0&&i<r&&Object(p.b)(b,{className:"PaginationButton-next",onSelect:s,text:"下一页",page:i+1}))}}]),t}(l.Component);f.defaultProps={current:1,total:1,onSelect:function(){}},n.d(t,"a",function(){return f})},2283:function(e,t,n){"use strict";var o=n(17),a=n(0),i=n(1),r=n.n(i),s=n(189),c=n(14),l=function(e){return r.a.createElement(c.a,e,r.a.createElement("path",{d:"M12 11l-3.716 3.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l4.249-4.512a.758.758 0 0 1 1.064 0l4.246 4.512a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063 0L12.002 11z",fillRule:"evenodd"}))};l.defaultProps={name:"ArrowUp"};var m=l,u=n(92),d=n.n(u);n(2308);function p(e){var t=e.onClick,n=e.commentsElRef,i=r.a.useState(!1),c=Object(o.a)(i,2),l=c[0],u=c[1],p=r.a.useState(0),b=Object(o.a)(p,2),h=b[0],f=b[1];return r.a.useEffect(function(){var e=n.current;if(e){var t=e.getBoundingClientRect().right;f(t-16)}},[n]),r.a.useEffect(function(){var e=d()(function(){var e=n.current;if(e){var t=window.innerHeight,o=e.getBoundingClientRect(),a=o.top,i=o.bottom,r=o.height;u(r>500&&i>t&&a<0)}},100);return window.addEventListener("scroll",e),function(){e.cancel(),window.removeEventListener("scroll",e)}},[n]),Object(s.c)(l,null,{from:{opacity:0,left:h},enter:{opacity:1,left:h},leave:{opacity:0,left:h}}).map(function(e){var n=e.item,o=e.key,i=e.props;return n&&Object(a.b)(s.a.button,{key:o,style:i,onClick:t,className:"CommentCollapseButton"},"收起评论",Object(a.b)(m,{center:!0}))})}n.d(t,"a",function(){return p})},2306:function(e,t,n){},2307:function(e,t,n){},2308:function(e,t,n){},2309:function(e,t,n){},2310:function(e,t,n){var o=n(953),a=n(286),i=n(461),r=Math.max,s=Math.min;e.exports=function(e,t,n){var c=null==e?0:e.length;if(!c)return-1;var l=c-1;return void 0!==n&&(l=i(n),l=n<0?r(c+l,0):s(l,c-1)),o(e,a(t,3),l,!0)}},2311:function(e,t,n){},2312:function(e,t,n){},2313:function(e,t,n){},2314:function(e,t,n){},2315:function(e,t,n){},2316:function(e,t,n){},2317:function(e,t,n){},2318:function(e,t,n){},2319:function(e,t,n){},2320:function(e,t,n){},2321:function(e,t,n){},2322:function(e,t,n){},2323:function(e,t,n){},2324:function(e,t,n){},2325:function(e,t,n){},2326:function(e,t,n){},2327:function(e,t,n){},2328:function(e,t,n){},2395:function(e,t){e.exports={attributes:{width:"72px",height:"58px",viewBox:"0 0 72 58"},content:'<defs>         <path d="M0.00434937116,11.7604183 C0.0014585125,11.8367351 0,11.9134174 0,11.9904392 L0,52.0095608 C0,55.3137533 2.68603825,58 5.99943435,58 L66.0005656,58 C69.3089213,58 72,55.317989 72,52.0095608 L72,11.9904392 C72,8.68624675 69.3139617,6 66.0005656,6 L31.1520961,6 L30.2346555,3.7077864 C29.4154984,1.66113281 26.9585394,0 24.7478675,0 L6.18638069,0 C2.86742525,0 0.139552484,2.68348852 0.0902454792,5.99373937 L0.00434937116,11.7604183 Z" id="path-1"></path>         <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="72" height="58" fill="white">             <use xlink:href="#path-1"></use>         </mask>     </defs>     <g id="空状态" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">         <g id="collection" transform="translate(-39.000000, -30.000000)" stroke="#E7EAF1">             <g transform="translate(39.000000, 30.000000)" id="Group-7">                 <g>                     <use id="Combined-Shape" mask="url(#mask-2)" stroke-width="6" xlink:href="#path-1"></use>                     <path d="M36.4126782,38.4800003 L30.2669271,41.2927815 C29.7656337,41.522213 29.4096881,41.2718295 29.4738593,40.716584 L30.2498317,34.0024302 L25.6755762,29.0266708 C25.3024658,28.6208107 25.4306014,28.2049135 25.9785012,28.0943637 L32.6038296,26.7575697 L35.9225353,20.8696 C36.1932338,20.3893332 36.6283715,20.3826781 36.9028211,20.8696 L40.2215268,26.7575697 L46.8468552,28.0943637 C47.3872665,28.2034026 47.5280608,28.6151866 47.1497802,29.0266708 L42.5755247,34.0024302 L43.3514971,40.716584 C43.4147912,41.2642406 43.0666691,41.5253922 42.5584293,41.2927815 L36.4126782,38.4800003 Z" id="Star" stroke-width="3"></path>                 </g>             </g>         </g>     </g>'}},2396:function(e,t,n){},2397:function(e,t,n){},2398:function(e,t,n){},2399:function(e,t,n){},2400:function(e,t,n){},2403:function(e,t,n){"use strict";n.r(t);var o=n(4),a=n(8),i=n(7),r=n(5),s=n(6),c=n(0),l=n(1),m=n.n(l),u=n(13),d=n.n(u),p=n(74),b=n.n(p),h=n(11);n(595);var f=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).rootRef=m.a.createRef(),n.unobserve=b.a,n.renderTarget=function(){var e=n.props.item,t=e.content.target,o=t.text,a=t.link,i=e.id,r=e.target,s=e.target,l=(s=void 0===s?{}:s).id,m=s.target,u=void 0===m?{}:m,d=u.type;return r&&"comment"===r.type?n.renderCommentButton(o,{type:d,href:a,byComment:l,target:u,notificationId:i}):Object(c.b)("span",null,a?Object(c.b)("a",{href:a,"data-za-detail-view-id":5109},o):Object(c.b)("span",null,o))},n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.addObserve,n=e.item.attachInfo,o=this.rootRef.current;h.default.setModule(o,{module:"Content"},{attached_info_bytes:n}),this.unobserve=t(o)}},{key:"componentWillUnmount",value:function(){this.unobserve()}},{key:"renderCommentButton",value:function(e,t){var n=this,o=t.href,a=t.byComment,i=t.notificationId;return Object(c.b)("a",{href:"".concat(o).concat(a?"#comment-".concat(a,"?notificationId=").concat(i):""),"data-za-detail-view-id":5109,onClick:function(e){e.preventDefault(),n.props.onCommentsModalOpen(t)}},e)}},{key:"render",value:function(){var e,t=this.props.item,n=t.content,o=n.verb,a=n.actors,i=t.isRead;return Object(c.b)("div",{ref:this.rootRef,className:d()("PushNotifications-item",{"PushNotifications-newItem":!i})},Object(c.b)("span",null,(e=a,Array.isArray(e)||(e=[e]),e.map(function(e,t){return Object(c.b)("span",{className:"PushNotifications-actor",key:t},e.link?Object(c.b)("a",{href:e.link,"data-za-detail-view-id":5109},e.name):Object(c.b)("span",null,e.name))})))," ",o," ",this.renderTarget())}}]),t}(l.Component);t.default=f},2406:function(e,t,n){"use strict";n.r(t);var o,a,i=n(16),r=n(25),s=n(3),c=n(4),l=n(8),m=n(7),u=n(5),d=n(6),p=n(0),b=n(2),h=n.n(b),f=n(1),v=n.n(f),C=n(11),O=n(36),j=n(45),g=n.n(j),y=n(949),k=n(9),I=n(37),N=(n(2321),"oneself"),w="enterprise",R={declare:{title:"发表澄清声明",image:"https://zhstatic.zhihu.com/assets/report/Statement@3x.png",description:(o={},Object(s.a)(o,N,"个人可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的形式显示在投诉内容的上方，点击可跳转至您的声明全文页面"),Object(s.a)(o,w,"企业可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的形式显示在投诉内容的上方，点击可跳转至您的声明全文页面"),o)},trespass:{title:"提交侵权举报",image:"https://zhstatic.zhihu.com/assets/report/Infringement@3x.png",description:Object(p.b)("span",null,"您提交的侵权举报将会根据知乎侵权举报规范进行受理")}},S=(a={},Object(s.a)(a,w,"当您发现知乎上存在涉嫌侵犯您企业合法权益的内容时，您可以先尝试与作者沟通解决，如沟通无效，也可以通过以下方式向知乎提出诉求。"),Object(s.a)(a,N,"当您发现知乎上存在涉嫌侵犯您个人合法权益的内容时，您可以通过以下方式向知乎提出诉求。"),a),P=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(e){C.default.trackEvent(e,{id:3467,aciton:"Click"})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){C.default.trackCardShow(null,{id:3466})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onSubMenuEnter,o=t.onBackClick,a=t.isMobile,i=t.childNodes,r=t.activeNode.reason,s=i.map(function(e){return Object.assign({},R[e.reason],{id:e.id})});return Object(p.b)("section",{className:g()("ReportInfringement",{"ReportInfringement--mobile":a})},Object(p.b)("p",{className:"ReportInfringement-subtitle"},S[r]),Object(p.b)("ul",{className:"ReportInfringement-list"},s.map(function(t){var o=t.image,a=t.title,i=t.description,s=t.id,c=i[r]||i;return Object(p.b)("li",{className:"ReportInfringement-item",key:a,"data-za-module":"Content","data-za-detail-view-path-module_name":a,onClick:function(t){e.handleClick(t.currentTarget),n(s)}},Object(p.b)("img",{className:"ReportInfringement-image",src:o}),Object(p.b)("div",{className:"ReportInfringement-content"},Object(p.b)("h1",{className:"ReportInfringement-itemTitle"},a),Object(p.b)("p",{className:"ReportInfringement-itemDescription"},c)),Object(p.b)(y.a,{className:"ReportInfringement-arrow"}))})),Object(p.b)(I.a,{direction:"horizontal"},Object(p.b)(k.c,{"data-za-module":"Content","data-za-detail-path-view-module_name":"返回",onClick:function(t){e.handleClick(t.currentTarget),o()}},"返回")))}}]),t}(v.a.Component),T=n(47),D=function(e){return"https://www.zhihu.com/account/infringement?".concat(Object(T.stringify)(e))};n(2322);function L(e){var t=e.infringementType;return Object(p.b)("p",{className:"ReportOrgContent"},"若您已注册机构号，可使用",Object(p.b)("span",{className:"ReportOrgContent-highlight"},"机构号"),"declare"===t?"发表澄清声明":"提交侵权举报","，",Object(p.b)("span",{className:"ReportOrgContent-highlight"},"免提交资质材料"),"。")}var F=n(46),x=function(e){return"".concat(window.location.origin,"/appview/account/infringement?").concat(Object(T.stringify)(e))};n(2323);function B(e){var t=e.isIndividualReason,n=e.onBackClick,o=e.urlToken,a=e.type;return Object(p.b)("div",{className:"InfringementReport-wrapper"},Object(p.b)("div",{className:"InfringementReport-title"},"提交侵权举报"),Object(p.b)("div",{className:"InfringementReport-subTitle"},"".concat(t?"个人侵权":"企业侵权")),Object(p.b)("div",{className:"InfringementReport-text"},Object(p.b)("ul",null,Object(p.b)("li",null,"根据"," ",Object(p.b)("a",{href:"https://www.zhihu.com/terms#sec-report",rel:"noopener noreferrer",target:"_blank",className:"InfringementReport-rules"},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料，并规范填写投诉说明。若您已确认完毕，请继续提交举报信息。"),!t&&Object(p.b)("li",null,Object(p.b)("br",null),"若您已注册机构号，可使用",Object(p.b)("span",null,"机构号"),"提交侵权举报，",Object(p.b)("span",null,"免提交资质材料"),"。"))),Object(p.b)("div",{className:"InfringementReport-buttonGroup"},Object(p.b)(k.c,{className:"InfringementReport-back",onClick:n},"返回"),Object(p.b)(k.c,{className:"InfringementReport-submit",onClick:function(){F.default.dispatch("base/openURL",{url:x({resourceId:o,type:a,reasonType:t?"inflictIndividual":"enterprise",route_simi_to_full:!0,zh_nav_right:"empty"})})}},"继续提交举报")))}n(2324);function E(e){var t=e.infringementType,n=e.isIndividualReason,o=e.onBackClick,a=e.urlToken,i=e.type,r=e.isUseInfringementReport,s="declare"===t;return Object(p.b)("div",null,s?Object(p.b)("div",{className:"ReportInfringementMobile"},Object(p.b)("p",{className:"ReportInfringementMobile-text"},"1."," ","".concat(n?"个人":"企业","可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。")),Object(p.b)("p",{className:"ReportInfringementMobile-text"},"2. 根据",Object(p.b)("a",{className:"ReportInfringementMobile-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料， 以发表澄清声明。 若您已确认完毕，",Object(p.b)("span",{className:"ReportInfringementMobile-bold"},"请到桌面版网页进行诉求提交。")),!n&&Object(p.b)("p",{className:"ReportInfringementMobile-text"},"若您已注册机构号，可使用机构号\n              '发表澄清声明' ，免提交资质材料。"),Object(p.b)("img",{className:"ReportInfringementMobile-img",src:"https://zhstatic.zhihu.com/report/app_report.png"}),Object(p.b)(k.c,{color:k.a.Blue,preset:k.b.Primary,onClick:o,className:"ReportInfringementMobile-button"},"我知道了")):r?Object(p.b)(B,{infringementType:t,isIndividualReason:n,onBackClick:o,urlToken:a,type:i}):Object(p.b)("div",{className:"ReportInfringementMobile"},Object(p.b)("p",{className:"ReportInfringementMobile-text"},"1. 您提交的侵权举报将会根据知乎侵权举报规范进行受理。"),Object(p.b)("p",{className:"ReportInfringementMobile-text"},"2. 根据",Object(p.b)("a",{className:"ReportInfringementMobile-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料， 并规范填写投诉说明。 若您已确认完毕，",Object(p.b)("span",{className:"ReportInfringementMobile-bold"},"请到桌面版网页进行诉求提交。")),!n&&Object(p.b)("p",{className:"ReportInfringementMobile-text"},"若您已注册机构号，可使用机构号".concat(s?"发表澄清声明":"提交侵权举报","，免提交资质材料。")),Object(p.b)("img",{className:"ReportInfringementMobile-img",src:"https://zhstatic.zhihu.com/report/app_report.png"}),Object(p.b)(k.c,{color:k.a.Blue,preset:k.b.Primary,onClick:o,className:"ReportInfringementMobile-button"},"我知道了")))}n(2325);var M=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(e){C.default.trackEvent(null,{id:3469,action:"Click"},{button:{text:e}})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){C.default.trackCardShow(null,{id:3468})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onBackClick,o=t.urlToken,a=t.type,i=t.isMobile,r=t.parentNode,s=t.isUseInfringementReport,c=!("enterprise"===r.reason);return i?Object(p.b)(E,{isIndividualReason:c,infringementType:"declare",onBackClick:n,type:a,urlToken:o,isUseInfringementReport:s}):Object(p.b)("section",{className:"ReportDeclare"},Object(p.b)("div",{className:"ReportDeclare-description"},"当您发现知乎上有关于您",c?"个人":"企业","的侵权内容时，您可通过此方式发表澄清声明。",Object(p.b)("br",null),Object(p.b)("br",null),"申请发表澄清声明的流程如下：",Object(p.b)("ul",null,Object(p.b)("li",null,"1. 在站内写一篇",Object(p.b)("a",{href:"https://zhuanlan.zhihu.com/write",target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.handleClick("澄清声明文章")}},"澄清声明文章"),"并发布。",Object(p.b)("a",{href:"https://zhstatic.zhihu.com/assets/report/template-v2.png",target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.handleClick("查看模版")}},"查看模版"),Object(p.b)("br",null)),Object(p.b)("li",null,"2.返回此页面继续发表声明，您需按照提示提供完整、有效的证明材料。",Object(p.b)("br",null)),Object(p.b)("li",null,"3.审核通过后，侵权纠纷内容上会关联展示您的澄清声明，点击可跳转至您的声明全文。")),!c&&Object(p.b)(L,{infringementType:"declare"})),Object(p.b)(I.a,{direction:"horizontal"},Object(p.b)(k.c,{onClick:n},"返回"),Object(p.b)(k.c,{onClick:function(){return e.handleClick("继续发表声明")},component:"a",href:D({infringementType:"declare",resourceId:o,type:a,reasonType:c?"inflictIndividual":"enterprise"}),className:"ReportDeclare-continue",color:k.a.Blue,preset:k.b.Primary},"继续发表声明")))}}]),t}(v.a.Component),A=(n(2326),function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(e){C.default.trackEvent(null,{id:3510,aciton:"Click"},{button:{text:e}})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){C.default.trackCardShow(null,{id:3509})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onBackClick,o=t.urlToken,a=t.type,i=t.isMobile,r=t.parentNode,s=t.isUseInfringementReport,c=!("enterprise"===r.reason);return i?Object(p.b)(E,{isIndividualReason:c,infringementType:"trespass",onBackClick:n,urlToken:o,type:a,isUseInfringementReport:s}):Object(p.b)("section",{className:"ReportTrespass"},Object(p.b)("p",{className:"ReportTrespass-description"},"根据",Object(p.b)("a",{href:"https://www.zhihu.com/terms#sec-report",onClick:function(){e.handleClick("知乎侵权举报规范")}},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料，并规范填写投诉说明。若您已确认完毕，请继续提交举报信息。"),!c&&Object(p.b)(L,{infringementType:"trespass"}),Object(p.b)(I.a,{direction:"horizontal"},Object(p.b)(k.c,{onClick:function(){e.handleClick("返回"),n()}},"返回"),Object(p.b)(k.c,{onClick:function(){e.handleClick("继续提交举报")},component:"a",href:D({resourceId:o,type:a,reasonType:c?"inflictIndividual":"enterprise"}),className:"ReportTrespass-continue",color:k.a.Blue,preset:k.b.Primary},"继续提交举报")))}}]),t}(v.a.Component)),q=[{id:0,text:"举报",childIds:[1,2,3,30001,4,5,21,7,8,9]},{id:1,text:"低质问题",types:["question","drama_statement"],childIds:[23,33,34,40,35,27,22]},{id:2,text:"垃圾广告信息",reason:"spam",copywriter:{title:"举报说明",placeholder:"举报详细说明（选填）",isRequired:!1},disabled:!0},{id:3,text:"不友善行为",types:["answer","comment","drama_bullet","article","pin","book_review","favlist","discussion_review"],childIds:[40,41],effects:["delete_comment"]},{id:30001,reason:"abuse",text:"辱骂、人身攻击等不友善行为",types:["zvideo"],copywriter:{title:"举报说明",placeholder:"举报详细说明（选填）",isRequired:!1},disabled:!0},{id:4,text:"有害信息",childIds:[19,30,39,26,18,28]},{id:5,text:"涉嫌侵权",childIds:[20,29,12],types:["question","drama_statement","answer","comment","drama_bullet","article","pin","book_review"],reason:"infringement",disabled:!0},{id:7,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0,types:["message","book_review","discussion_review","drama_statement","drama_bullet"]},{id:8,reason:"direction",shouldShow:function(e){return e.isColumnArticle}},{id:9,reason:"tipjar",shouldShow:function(e){return e.isTipjarEnabled}},{id:12,reason:"enterprise",disabled:!0,customComponent:P,childIds:[48,49]},{id:17,reason:"spam"},{id:18,reason:"illegality",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:19,reason:"politics"},{id:20,reason:"repost",copywriter:{title:"不规范转载说明",placeholder:"原文链接或补充说明（必填）",maxLength:1e3},types:["answer","article","pin","book_review"],disabled:!0},{id:21,reason:"temptation",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0,types:["answer","comment","drama_bullet","article","column","zvideo"]},{id:22,reason:"personal"},{id:23,reason:"ambiguity"},{id:26,reason:"suicide",types:["question","drama_statement","answer","article","pin","book_review","comment","drama_bullet","zvideo"]},{id:27,reason:"medicine"},{id:28,reason:"superstition"},{id:29,reason:"oneself",disabled:!0,customComponent:P,childIds:[46,47]},{id:30,reason:"porn"},{id:33,reason:"subjective"},{id:34,reason:"rumour"},{id:35,reason:"provoke"},{id:39,text:"不实信息",types:["answer","comment","drama_bullet","article","pin","book_review","zvideo"],childIds:[42,43,44,45]},{id:40,reason:"abuse"},{id:41,reason:"unfriendly",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:42,reason:"untruth_science",text:"科学类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:43,reason:"untruth_rumor",text:"社会谣言类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:44,reason:"untruth_fake_profile",text:"编造经历类不实信息",copywriter:{title:"举报说明",placeholder:"请提供被举报内容中编造经历的佐证，如内容中存在的不实信息、前后矛盾的段落或其他详细信息。（必填）"},disabled:!0,types:["answer","comment","drama_bullet","article","pin","book_review"]},{id:45,text:"诽谤等侵权信息",childIds:[20,29,12],types:["answer","comment","drama_bullet","article","pin","book_review"]},{id:46,customComponent:M,text:"发表澄清声明",reason:"declare",types:["answer","article","pin"],subtitle:"个人侵权"},{id:47,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"个人侵权"},{id:48,customComponent:M,text:"发表澄清声明",reason:"declare",types:["answer","article","pin"],subtitle:"企业侵权"},{id:49,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"企业侵权"}],z=[{id:0,text:"举报",childIds:[1,2,3,4]},{id:1,text:"垃圾广告信息",reason:"spam"},{id:2,text:"不友善行为",reason:"unkind"},{id:3,text:"有害信息",reason:"imitation"}],U=[{id:0,text:"举报",childIds:[1,2,3]},{id:1,reason:"abuse"},{id:2,reason:"harassment"},{id:3,reason:"spam"}],_=[{id:0,text:"举报",childIds:[1,4,6,7]},{id:1,text:"冒充我或他人",childIds:[8,9],reason:"fake",disabled:!0},{id:4,reason:"spam",text:"垃圾广告帐号"},{id:6,reason:"profile",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,text:"冒充我",subtitle:"请选择举报理由",reason:"oneself",disabled:!0,childIds:[10,11]},{id:9,reason:"impersonate",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},text:"冒充他人",disabled:!0},{id:10,reason:"oneself",disabled:!0,isRequired:!0,customComponent:P,childIds:[12]},{id:11,reason:"enterprise",disabled:!0,isRequired:!0,customComponent:P,childIds:[13]},{id:12,isRequired:!0,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"个人侵权"},{id:13,isRequired:!0,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"企业侵权"}],V=[{id:0,text:"举报",childIds:[2,3,4,5,14,15,16,17,18,700]},{id:2,reason:"abuse",text:"骚扰/辱骂/歧视等不友善行为"},{id:3,reason:"illegality",text:"发过违反法律法规的内容"},{id:4,reason:"spam",text:"垃圾广告帐号"},{id:5,reason:"politics",text:"发过政治敏感内容"},{id:14,reason:"minor"},{id:15,reason:"porn"},{id:16,reason:"uncivilized_behavior"},{id:17,reason:"suicide",text:"疑似自杀或自残"},{id:18,reason:"superstition"},{id:700,reason:"old",text:"其他",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0}],W=[{id:0,text:"举报",childIds:[1]},{id:1,reason:"profile"}],H=n(17),G=n(32),K=n(58),J=n.n(K),Z=n(313),Q=n(2256),Y=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(m.a)(this,Object(u.a)(t).call(this))).handleClick=e.handleClick.bind(Object(G.default)(e)),e}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handleClick",value:function(){var e=this.props,t=e.id,n=e.reason,o=e.disabled,a=e.onSubMenuEnter,i=e.onItemSelect;n&&!o?i(t):a(t)}},{key:"render",value:function(){var e=this.props,t=e.reason,n=e.text,o=e.disabled,a=e.isSelected,i=e.id,r=n||Z.b[t];return Boolean(t&&!o)?Object(p.b)("label",{className:"ReportMenu-item",htmlFor:t},Object(p.b)("div",{className:"ReportMenu-itemValue needsclick"},r),Object(p.b)("input",{className:"ReportMenu-itemCheck",type:"radio",name:"report",value:i,id:t,checked:a,onChange:this.handleClick}),Object(p.b)(Q.a,{size:18,className:"ReportMenu-itemCheckIcon",name:"checkRound"})):Object(p.b)("button",{className:"ReportMenu-item",onClick:this.handleClick},Object(p.b)("span",{className:"ReportMenu-itemValue"},r),Object(p.b)(y.a,{size:18}))}}]),t}(f.Component);Y.propTypes={id:h.a.number.isRequired,reason:h.a.string,text:h.a.string,disabled:h.a.bool,isSelected:h.a.bool,onSubMenuEnter:h.a.func.isRequired,onItemSelect:h.a.func.isRequired};var $=n(57),X=function(e){function t(){return Object(c.a)(this,t),Object(m.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.copywriter.placeholder,n=e.onDetailInput,o=e.errorText,a=e.checkCustomReasonContent;return Object(p.b)("div",{className:"ReportMenu-inner"},Object(p.b)($.a,{multiline:!0,grey:!0,rows:5,className:"ReportMenu-textarea",placeholder:t,onChange:function(e){return n(e.target.value)},onBlur:a}),Object(p.b)("div",{className:"ReportMenu-errorText"},o))}}]),t}(f.Component);X.propTypes={onDetailInput:h.a.func.isRequired,copywriter:h.a.object,errorText:h.a.string};n(2327);var ee=function(e){function t(){return Object(c.a)(this,t),Object(m.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.checked,n=e.onChange,o=e.name,a=e.text,i=e.desc,r=o||a;return Object(p.b)("div",null,Object(p.b)("label",{className:"ReportOption-check",htmlFor:r},Object(p.b)("input",{type:"checkbox",name:r,checked:t,onChange:n}),Object(p.b)("span",null,"同时",a)),i&&Object(p.b)("div",{className:"ReportOption-desc"},i))}}]),t}(f.Component),te=function(e,t){var n=t&&t.maxLength;return e.length>(n||150)?{isLegal:!1,errorReason:n?"".concat(t.title||"举报说明","不能超过 ").concat(n," 字"):Z.a.contentTooLong}:/[\u4e00-\u9fa5a-zA-Z0-9]/.test(e)?{isLegal:!0,errorReason:""}:{isLegal:!1,errorReason:Z.a.contentIllegal}},ne=(n(2328),function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={blockChecked:!1,commentChecked:!1,activeId:0,parentId:null,selectedId:null,errorText:"",isMobile:!1,isSubmiting:!1,isSubmited:!1,path:[]},n.menuItems={},n.getReportText=function(e){if(!e)return"";var t=n.props.nodes[e];return t&&(t.text||Z.b[t.reason])||""},n.getReportLevel=function(){return"第 ".concat(n.state.path.length+1," 级")},n.handleItemSelect=function(e){var t=n.selectedId===e?null:e;n.setState({selectedId:t});var o=n.props,a=o.zaEnabled,i=o.type;t&&a&&C.default.trackEvent(null,{action:"Select",element:"Menu",id:2883,name:n.getReportLevel()},{button:{text:n.getReportText(e)},report:{id:e,type:i}})},n.handleSubMenuEnter=function(e){n.setState(function(t){var n=t.activeId,o=t.path;return{activeId:e,parentId:n,selectedId:null,path:o.concat([e])}});var t=n.props,o=t.zaEnabled,a=t.type;o&&C.default.trackEvent(null,{action:"Expand",element:"Menu",id:2883,name:n.getReportLevel()},{button:{text:n.getReportText(e)},report:{id:e,type:a}})},n.hasEffectOfDeleteComment=function(){var e=n.props.nodes,t=n.state,o=t.parentId,a=t.activeId,i=e[o||a];return Boolean(i&&i.effects)&&i.effects.includes("delete_comment")},n.handleDetailInput=function(e){n.setState({customReason:e,errorText:""})},n.handleBackClick=function(){var e=n.props.nodes,t=n.state,o=t.parentId,a=t.path,i=Object.keys(e).find(function(t){var n=e[t].childIds;return n&&n.includes(o)});n.setState({activeId:o,parentId:i&&Number(i),selectedId:null,hasWarning:!1,customReason:"",errorText:"",path:a.slice(0,-1)});var r=n.props,s=r.zaEnabled,c=r.type;s&&C.default.trackEvent(null,{action:"Back",element:"Button",id:2884,name:n.getReportLevel()},{report:{id:n.state.activeId,type:c}})},n.handleSubmit=function(){var e=n.state,t=e.selectedId,o=e.customReason,a=e.activeId;if(n.isSubmitEnabled()&&n.checkCustomReasonContent()){var i=n.props,r=i.nodes,s=i.onSubmit,c=i.onDeleteComment,l=r[t||a],m=l.reason,u=l.id;n.setState({isSubmiting:!0});var d=s({reason:m,customReason:o});d&&d.then?d.then(n.submitEnd):n.submitEnd();var p=n.props,b=p.zaEnabled,h=p.type;if(b){var f=c&&n.hasEffectOfDeleteComment();C.default.trackEvent(null,{id:2885,name:n.getReportLevel(),action:"Click"},{report:{type:h},button:{text:n.getReportText(u)}}),C.default.trackEvent(Object(G.default)(n),Object.assign({action:"Report",element:"Button"},f&&{id:3039,name:m}),Object.assign({report:{id:u,type:h}},f&&{button:{text:n.state.commentChecked?"举报并删除":"仅举报"}}))}}},n.submitEnd=function(e){n.setState({isSubmiting:!1,isSubmited:!0});var t=n.state,o=t.blockChecked,a=t.commentChecked,i=n.props,r=i.onBlockUser,s=i.onDeleteComment,c=i.onEnd;Promise.all([o&&r&&r(),a&&s&&s()].map(function(e){return Promise.resolve(e).catch(function(e){return e})})).then(function(t){var n=Object(H.a)(t,2),o=n[0],a=n[1];c&&c({result:e,blockUserResult:o,commentDeleteResult:a})})},n.checkCustomReasonContent=function(){var e=n.state,t=e.activeId,o=e.customReason,a=n.props.nodes[t].copywriter;if(Boolean(a)&&o){var i=te(o,a),r=i.isLegal,s=i.errorReason;if(!r)return n.setState({errorText:s}),!1}return!0},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.type,t=J()(navigator.userAgent);this.setState({isMobile:t.Mobile}),C.default.trackCardShow(null,{id:2890},{button:{text:e}})}},{key:"componentWillUpdate",value:function(e,t){var n=this.state.activeId,o=t.activeId,a=this.props,i=a.nodes,r=a.onContentChange;if(o!==n){var s=i[o],c=s.reason,l=s.text,m=s.childIds,u=s.copywriter,d=s.subtitle;r(l||Z.b[c],d||u&&u.title||(m?void 0:""))}}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.zaEnabled,n=e.type,o=this.state.isSubmited;t&&!o&&C.default.trackEvent(null,{id:4328,action:"Close",name:this.getReportLevel()},{report:{type:n}})}},{key:"isSubmitEnabled",value:function(){var e=this.state,t=e.selectedId,n=e.activeId,o=e.customReason,a=this.props.nodes;return t||Boolean(a[n].copywriter)&&(!1===a[n].copywriter.isRequired||o)}},{key:"render",value:function(){var e=this,t=this.props,n=t.nodes,o=t.options,a=t.isUseInfringementReport,s=Object(r.a)(t,["nodes","options","isUseInfringementReport"]),c=this.state,l=c.activeId,m=c.parentId,u=c.selectedId,d=c.errorText,b=c.isMobile,h=n[l],f=h.childIds,v=h.copywriter,C=h.customComponent,O=f&&f.map(function(e){return n[e]}).filter(function(e){return e&&(!e.shouldShow||e.shouldShow(s))});if(void 0!==C)return Object(p.b)(C,Object(i.default)({onBackClick:this.handleBackClick,onItemSelect:this.handleItemSelect,onSubMenuEnter:this.handleSubMenuEnter},this.props,this.state,{activeNode:h,parentNode:n[m],childNodes:O,isUseInfringementReport:a}));var j=Boolean(f),y=Boolean(v),N=j&&Object(p.b)("div",{className:"ReportMenu-inner ReportMenu-options"},O.map(function(t){return Object(p.b)(Y,Object(i.default)({ref:function(n){e.menuItems[t.id]=n},key:t.id},t,{isSelected:u===t.id,onSubMenuEnter:e.handleSubMenuEnter,onItemSelect:e.handleItemSelect}))})," ")||y&&Object(p.b)(X,{onDetailInput:this.handleDetailInput,copywriter:v,errorText:d,checkCustomReasonContent:this.checkCustomReasonContent}),w=j&&s.talkerToken&&Object(p.b)(ee,{checked:this.state.blockChecked,text:"将此人屏蔽",onChange:function(t){return e.setState({blockChecked:t.target.checked})}}),R=n[m||l],S=s.onDeleteComment&&this.hasEffectOfDeleteComment()&&Object(p.b)(ee,{checked:this.state.commentChecked,desc:R&&"社区鼓励举报".concat(R.text,"，同时可以直接删除该评论，删除操作并不影响对违规内容和违规用户的处理。"),onChange:function(t){return e.setState({commentChecked:t.target.checked})},text:"删除该评论"}),P=this.props.isSubmiting;return Object(p.b)("div",{className:g()("ReportMenu",{"ReportMenu-mobile":b})},N,(w||S)&&Object(p.b)("div",null,w,S,o),Object(p.b)(I.a,{direction:"horizontal"},"number"==typeof m&&Object(p.b)(k.c,{onClick:this.handleBackClick}," 返回 "),(j||y)&&Object(p.b)(k.c,{className:"ReportMenu-button",disabled:P||!this.isSubmitEnabled(),onClick:this.handleSubmit,color:"blue",preset:"primary"},"举报")))}}]),t}(f.Component));ne.propTypes={nodes:h.a.object.isRequired,onContentChange:h.a.func.isRequired,onSubmit:h.a.func.isRequired,onEnd:h.a.func,onBlockUser:h.a.func,onDeleteComment:h.a.func,isColumnArticle:h.a.bool,isTipjarEnabled:h.a.bool,isUseInfringementReport:h.a.bool},ne.defaultProps={isUseInfringementReport:!1};var oe=ne,ae=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).filterNodes=function(e,t,n){var o=e.filter(function(e){return!!e.isRequired||(-1!=["infringement","repost","oneself","enterprise","fake"].indexOf(e.reason)||0===e.id||("question"!==t||-1==["closed","suggested","evaluated","locked"].indexOf(n)||0===e.id)&&("member"!==t||-1==["ban","hang"].indexOf(n)||"profile"===e.reason))});return 1===o.length&&0===o[0].id&&(o=[]),o},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.type,o=t.status,a=Object(r.a)(t,["type","status"]);return e="message"===n?U:["member","club_mask"].includes(n)?_:["drama","drama_connect_member"].includes(n)?V:"theater"===n?W:"favlist"===n?z:q.filter(function(e){return!e.types||e.types.includes(n)}),e=this.filterNodes(e,n,o),Object(p.b)(oe,Object(i.default)({nodes:e.reduce(function(e,t){return Object.assign({},e,Object(s.a)({},t.id,t))},{})},a,{type:n}))}}]),t}(f.Component);ae.propTypes={type:h.a.string.isRequired};var ie=n(2274),re=function(e){return"article"===e?"Post":"book_review"===e?"BookReview":"".concat(e.slice(0,1).toUpperCase()).concat(e.slice(1))},se=n(116),ce="请选择举报理由",le="举报",me=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={title:void 0!==n.props.title?n.props.title:le,subtitle:void 0!==n.props.subtitle?n.props.subtitle:ce},n.handleSubmit=function(e){var t=e.reason,o=e.customReason,a=n.props,i=a.urlToken,r=a.type;return n.props.doReport(i,r,t,o)},n.handleContentChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce;n.setState({title:e,subtitle:t})},n.handleClose=function(){n.props.zaEnabled&&C.default.trackEvent(n.container,{action:"Ok"},{button:{text:"知道了"}}),n.props.onClose()},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){if(!e.shown&&this.props.shown){var t=this.props,n=t.type,o=t.id;C.default.setModule(this.container,{module:"ReportDialog"},{card:{card_type:"Content",content:Object(s.a)({type:re(n)},"comment"===n?"id":"token",String(o))}})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.shown,o=t.onClose,a=Object(r.a)(t,["shown","onClose"]),s=this.state,c=s.title,l=s.subtitle,m=Object(ie.a)(a,Object.keys(O.b.propTypes)),u=m.selectedProps,d=m.dropedProps;return Object(p.b)(O.b,Object(i.default)({title:c,subtitle:l,onClose:this.handleClose,className:"ReportModal"},u),n&&Object(p.b)(ae,Object(i.default)({ref:function(t){e.container=t},onSubmit:this.handleSubmit,onEnd:o,onContentChange:this.handleContentChange},d)))}}]),t}(f.Component);me.propTypes={onClose:h.a.func.isRequired,type:h.a.oneOf(se.a).isRequired,shown:h.a.bool.isRequired,isColumnArticle:h.a.bool,isTipjarEnabled:h.a.bool,onBlockUser:h.a.func,onDeleteComment:h.a.func,doReport:h.a.func.isRequired,zaEnabled:h.a.bool},me.defaultTypes={zaEnabled:!1},n.d(t,"ReportModal",function(){return me})},2407:function(e,t,n){"use strict";n.r(t);var o,a,i,r=n(16),s=n(25),c=n(4),l=n(8),m=n(7),u=n(5),d=n(6),p=n(0),b=n(1),h=n.n(b),f=n(2),v=n.n(f),C=n(12),O=n(13),j=n.n(O),g=n(588),y=n(2310),k=n.n(y),I=n(65),N=n(2282),w=n(42),R=n(24),S=n(80),P=n(131),T=n(27),D=n(141),L=n(205),F=n(130),x=n(10),B=n(32),E=n(38),M=n(30),A=n(11),q=n(118),z=n.n(q),U=n(33),_=n.n(U),V=n(9),W=n(596),H=n(31),G=n(83),K=n(266),J=n(102),Z=n(166),Q=n(204),Y=n(2245),$=n(2237),X=n(104),ee=n(20),te="zhihu::comment_local_key",ne=5,oe=(ee.B,1e3),ae=980,ie=function(){return""},re={error:"上传失败",success:"上传成功",uploadIng:"上传中",default:""},se=(n(2311),Object(C.connect)(null,{showNotification:R.g,uploadImage:X.b})((i=a=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={uploadStatus:re.default},n.triggerClick=function(e){var t=n.props.handleInputActive;n.uploadInput.click(),t(!0),e.preventDefault()},n.onError=function(){var e=n.props,t=e.showNotification,o=e.resetUploadImg;t("图片上传失败","red"),o()},n.onSuccess=function(){n.setState({uploadStatus:re.default})},n.resetFileInput=function(){n.uploadInput.value=null},n.beforeUpload=function(e){var t=n.props.showNotification;return e?e.size>1024*ee.B*1024?(t("请上传小于 ".concat(ee.B,"M 的图片。"),"red"),n.resetFileInput(),!1):(n.reactPopoverNode.open(),void n.setState({uploadStatus:re.uploadIng})):(n.resetFileInput(),!1)},n.uploadImage=function(e){var t=e.file,o=n.props,a=o.uploadImage,i=o.handleImages,r=o.updatePublishStatus;return a(t).then(function(e){i([Object.assign({},e.payload,{url:e.payload.src})]),r(!1),n.resetFileInput()}).catch(function(){n.setState({uploadStatus:re.error}),i([])})},n.handleOnRef=function(e){var t=n.props.onRef;t&&t(e),n.reactPopoverNode=e},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.images,o=t.disableButton,a=t.resetUploadImg,i=this.state.uploadStatus,r=Boolean(n.length);return Object(p.b)(b.Fragment,null,Object(p.b)(J.a,{className:"ImagePopover",arrowed:!0,ref:this.handleOnRef,placement:"bottom",globalClose:!n.length,onClick:this.triggerClick,toggler:Object(p.b)(Z.a,{label:"插入图片",icon:Y.a,disabled:o})},Object(p.b)("div",{className:"ImagePopover-thumbnail"},r&&Object(p.b)(b.Fragment,null,Object(p.b)("img",{src:n[0].src}),Object(p.b)("div",{className:"closeButton",onClick:a},Object(p.b)($.a,null))),i&&!r&&Object(p.b)("p",{className:"ImagePopover-uplodaStatus"},i))),Object(p.b)(Q.a,{accept:"image/png,image/jpeg",onRef:function(t){e.uploadInput=t},beforeUpload:this.beforeUpload,customUpload:this.uploadImage,onSuccess:this.onSuccess,onError:this.onError}))}}]),t}(b.Component),a.propTypes={className:v.a.string,disableButton:v.a.bool},a.defaultProps={disableButton:!0},o=i))||o),ce=n(44),le=n(2247),me=n(14),ue=function(e){return h.a.createElement(me.a,e,h.a.createElement("path",{d:"M16.375 3.018C19.701 4.643 22 8.047 22 12a9.944 9.944 0 0 1-1.349 5c-1.73 2.986-4.952 5-8.651 5-3.7 0-6.921-2.014-8.651-5A9.944 9.944 0 0 1 2 12c0-3.951 2.298-7.357 5.625-8.982A9.95 9.95 0 0 1 12 2c1.571 0 3.051.373 4.375 1.018zm-4.322 11.17c1.5 0 2.911.662 3.871 1.817a.6.6 0 0 1-.514.978.599.599 0 0 1-.406-.214 3.823 3.823 0 0 0-2.951-1.385c-.605 0-1.185.136-1.723.407a3.85 3.85 0 0 0-1.321 1.093c-.039.05-.091.081-.141.116H8.19c-.006-.004-.013-.003-.018-.006a.6.6 0 0 1-.11-.839 5.074 5.074 0 0 1 1.73-1.433 4.988 4.988 0 0 1 2.26-.534zM8.875 10.75a1.25 1.25 0 1 1 0-2.5 1.25 1.25 0 0 1 0 2.5zm6.25-2.5a1.25 1.25 0 1 1-.001 2.5 1.25 1.25 0 0 1 0-2.5zM19.17 17a8.695 8.695 0 0 0 1.58-5c0-3.23-1.764-6.05-4.375-7.566A8.698 8.698 0 0 0 12 3.25a8.69 8.69 0 0 0-4.375 1.184C5.014 5.95 3.25 8.77 3.25 12c0 1.859.586 3.581 1.579 5 1.583 2.264 4.205 3.75 7.171 3.75 2.965 0 5.586-1.486 7.17-3.75z",fillRule:"evenodd"}))};ue.defaultProps={name:"Sad"};var de=ue,pe=(n(2312),function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(m.a)(this,Object(u.a)(t).call(this,e))).state={isGifReady:!1,isGifError:!1},n.renderLoadStatus=function(){var e=n.state.isGifError;return Object(p.b)("div",{className:"CommentSticker-load"},e?Object(p.b)(h.a.Fragment,null,Object(p.b)(de,{className:"CommentSticker-load-Icons"}),"加载失败"):Object(p.b)(h.a.Fragment,null,Object(p.b)(le.a,{className:"CommentSticker-load-Icons"}),"加载中"))};var o=n.props.src;return Object(ce.loadImage)(Object(ce.imgUrl)(o)).then(function(){n.setState({isGifReady:!0})}).catch(function(){n.setState({isGifError:!0})}),n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.isGifReady,t=this.props,n=t.src,o=t.handleStickerClick;return Object(p.b)("div",{className:"CommentSticker"},e?Object(p.b)("img",{src:n,className:"CommentSticker-img",onClick:o}):this.renderLoadStatus())}}]),t}(h.a.Component));pe.propsTypes={handleStickerClick:v.a.func};var be=pe,he=(n(2313),function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).handleOnRef=function(e){var t=n.props.onRef;t&&t(e)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.sticker,o=e.stickers,a=e.disableButton,i=e.handleStickerPopoverOpen,r=e.handleStickerPopoverClose,s=e.resetStickers,c=e.addSticker,l=e.handleEmotionClick;return Object(p.b)(J.a,{className:t,arrowed:!0,ref:this.handleOnRef,globalClose:!n.length,preventCloseOnTarget:!0,onClick:l,onOpen:i,onClose:r,toggler:Object(p.b)(Z.a,{label:"插入表情",icon:le.a,disabled:a}),placement:"bottom"},Boolean(n.length)&&Object(p.b)("li",{className:"StickerPopover-stickers-item StickerPopover-stickers-item-single"},Object(p.b)("img",{src:Object(ce.imgUrl)(n[0].url),alt:n[0].title}),Object(p.b)("div",{className:"closeButton",onClick:s},Object(p.b)($.a,null))),!n.length&&Object(p.b)("div",{className:"StickerPopover-stickers-wrap"},Object(p.b)("ul",{className:"StickerPopover-stickers-list"},o.map(function(e){var t=e.url,n=e.title,o=e.id;return Object(p.b)("li",{className:"StickerPopover-stickers-item",key:o},Object(p.b)(be,{width:48,height:48,src:t,handleStickerClick:function(){return c(e)}}),Object(p.b)("p",null,n))}))))}}]),t}(b.Component));he.propTypes={className:v.a.string,disableButton:v.a.bool},he.defaultProps={disableButton:!0};var fe=n(36);n(2314);function ve(e){var t=e.onClose,n=e.onSubmit,o=e.noBanner;return Object(p.b)(fe.b,{className:j()("CommentCheckModal-wrapper",o&&"CommentCheckModal--noBanner"),onClose:t},!o&&Object(p.b)("div",{className:"CommentCheckModal-image"}),Object(p.b)("div",{className:"CommentCheckModal-title"},"评论可能包含不友善内容"),Object(p.b)("div",{className:"CommentCheckModal-content"},"友善的交流是沟通的起点，请遵守知乎社区规范，认真友善发言"),Object(p.b)("div",{className:"CommentCheckModal-button"},Object(p.b)(V.c,{className:"CommentCheckModal-submit",onClick:n,preset:"primary"},"继续发布"),Object(p.b)(V.c,{className:"CommentCheckModal-modify",onClick:t,preset:"primary",color:"blue"},"返回修改")))}var Ce,Oe,je,ge;n(2315);function ye(){var e=Object(F.a)(["回复","",""]);return ye=function(){return e},e}var ke,Ie,Ne,we,Re=(Ce=Object(C.connect)(function(e){return{stickers:e.commentsV2.stickers||[],commentWithPicPermission:e.commentsV2.commentWithPicPermission||{},autoCheckAb:Object(H.a)(e,"web_unfriendly_comm")}},{showNotification:R.g}),Object(M.withRouter)(Oe=Ce((ge=je=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={active:!1,hasNoContent:!0,shown:!1,submitting:!1,value:{toHTML:ie},images:[],uploadIsFetchingNum:0,sticker:[],stickerIconActive:!1,toggleInputStyle:!1,commentTextLength:0,showCommentCheckModal:!1},n.handleCheckClosed=function(){n.setState({showCommentCheckModal:!1}),n.trackCommentCheckClick("返回修改"),n.input.focus()},n.handleCommentCheck=function(){n.setState({showCommentCheckModal:!1}),n.handleSubmit(!1),n.trackCommentCheckClick("继续发布")},n.handleButtonSubmit=function(){n.handleSubmit(!0,"0"!==n.props.autoCheckAb)},n.handleSubmit=n.context.authRequired(function(e,t){return n.context.realNameRequired(function(){var o=n.props,a=o.replyTo,i=o.onSubmit,r=o.onCancel,s=o.rootCommentId,c=o.isConversation,l=o.zaInfo.zaSubmitCommentId;if(!n.state.submitting){n.setState({submitting:!0});var m=n.state,u=m.images,d=m.sticker,p=n.input.toHTML();if(p||u.length||d.length){p&&n.saveLocalComment();var b=p;if(u.length||d.length){var h=u[0]||d[0],f=u[0]?u[0].url.includes(".gif")?"comment_gif":"comment_img":"comment_sticker";b+='<a class="'.concat(f,"\" href='").concat(h.url,"' data-width='").concat(h.dataRawwidth||"","' data-height='").concat(h.dataRawheight||"","'>[").concat(h.title||"图片","]</a>")}var v=i(b,a,{rootCommentId:s,isConversation:c},e,t);v.then?v.then(function(){r&&r(),n.input?(n.input.reset(),n.resetImage(),n.setState({value:{toHTML:ie}},function(){return n.saveLocalComment()})):n.saveLocalComment({toHTML:ie})}).catch(function(e){40313===e.payload.code&&n.setState({showCommentCheckModal:!0})}).finally(function(){n.setState({submitting:!1})}):(n.setState({submitting:!1}),r&&r(),n.input.reset()),A.default.trackEvent(Object(B.default)(n),Object.assign({action:"Comment",element:"Button"},l&&{id:l}))}}})()},void 0,R.b),n.handleCommentShow=n.context.authRequired(function(){n.setState({shown:!0}),n.hiddenInput.focus()}),n.handleCommentHide=function(){n.setState({shown:!1})},n.initLocalComment=function(){var e=n.props,t=e.type,o=e.id;if(t&&o){var a=_.a.get(te)||[],i="".concat(t,"_").concat(o),r=a.find(function(e){return e.key===i}),s=r&&r.value;s&&n.setState({value:{toHTML:function(){return s}},hasNoContent:!1})}},n.saveLocalComment=function(e){var t=n.props,o=t.type,a=t.id;if(o&&a){var i=e?e.toHTML():n.state.value.toHTML(),r="".concat(o,"_").concat(a),s=(_.a.get(te)||[]).filter(function(e){return e.key!==r}),c=i?[].concat(Object(x.a)(s.slice(0,ne-1)),[{key:r,value:i}]):s;_.a.set(te,c)}},n.handleChange=function(e){var t=n.state,o=t.sticker,a=t.images;o.length||a.length?n.setState({value:e}):n.setState({value:e,hasNoContent:e.isEmpty}),n.handleInputChange()},n.handleFocus=function(){n.setState({active:!0},n.handleInputChange)},n.handleBlur=function(){var e=n.state,t=e.sticker,o=e.images;t.length||o.length||(n.setState({active:!1}),n.handleInputChange())},n.handleMobileComment=function(){n.handleSubmit(),n.handleCommentHide()},n.handleEmotionClick=function(){var e=n.state.stickerIconActive;e&&n.setState({stickerIconActive:e},n.stickerPopover.close)},n.handleInputChange=function(){var e,t=Object(E.findDOMNode)(n.input);t&&(t.getBoundingClientRect().height>40?n.setState({toggleInputStyle:!0}):n.setState({toggleInputStyle:!1}),e="innerText"in document?t.innerText.length:t.textContent.length,n.setState({commentTextLength:e}),n.imgUploadPopover&&n.imgUploadPopover.position(),n.stickerPopover&&n.stickerPopover.position())},n.handleStickerPopoverOpen=function(){n.setState({active:!0,stickerIconActive:!0},n.stickerPopover.position),setTimeout(n.stickerPopover.position,400)},n.handleStickerPopoverClose=function(){n.setState({stickerIconActive:!1})},n.handleImages=function(e){n.setState({images:e},n.imgUploadPopover.position)},n.handleInputActive=function(e){n.setState({active:e})},n.updatePublishStatus=function(e){n.setState({hasNoContent:e})},n.resetStickers=function(){var e=n.state.value,t=void 0===e.isEmpty||e.isEmpty;n.stickerPopover&&n.stickerPopover.close(),n.setState({sticker:[],hasNoContent:t})},n.resetImage=function(){n.resetStickers(),n.resetUploadImg()},n.resetUploadImg=function(){var e=n.state.value,t=void 0===e.isEmpty||e.isEmpty;n.imgUploadPopover&&n.imgUploadPopover.close(),n.setState({images:[],hasNoContent:t})},n.addSticker=function(e){n.setState({sticker:[e],hasNoContent:!1},n.stickerPopover.position)},n.focusInput=function(e){e.preventDefault(),n.input.focus()},n.createImageOnRef=function(e){n.imgUploadPopover=e},n.createStickerOnRef=function(e){n.stickerPopover=e},n.renderInput=function(e){var t=e.placeholder,o=e.className,a=n.props,i=a.autoFocus,r=a.stickers,s=a.commentWithPicPermission.commentWithPic,c=n.state,l=c.images,m=c.sticker,u=c.stickerIconActive,d=c.toggleInputStyle,b=c.active,h=c.hasNoContent,f=c.commentTextLength,v=Boolean(m.length)||Boolean(l.length);return Object(p.b)("div",{className:j()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":d,"CommentEditorV2-inputWrap--active":b||!h}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()}},Object(p.b)(G.b,{keyMap:{FOCUS_COMMENT_INPUT:"shift+c"},handlers:{FOCUS_COMMENT_INPUT:n.focusInput}}),Object(p.b)(K.a,{className:j()("CommentEditorV2-input",o),defaultValue:n.state.value.toHTML(),allowMention:!0,allowPasteRichText:!1,autoFocus:i,outputBlockType:"div",ref:function(e){n.input=e},placeholder:t,onFocus:n.handleFocus,onChange:n.handleChange,onSubmit:n.handleButtonSubmit,minRows:5}),Object(p.b)("div",{className:j()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":d,"CommentEditorV2-inputUpload--SpaceBetween":d&&f>ae})},d&&f>ae&&Object(p.b)(W.a,{className:"CommentEditorV2-MaxLength",current:f,max:oe}),Object(p.b)("div",{className:"CommentEditorV2-popoverWrap"},s&&Object(p.b)(se,{onRef:n.createImageOnRef,images:l,disableButton:v,resetUploadImg:n.resetUploadImg,handleInputActive:n.handleInputActive,updatePublishStatus:n.updatePublishStatus,handleImages:n.handleImages}),Object(p.b)(he,{className:j()("CommentEditorV2-inputUpLoad-Icon",{"CommentEditorV2-inputUpLoad-Icon--active":u&&!m.length}),onRef:n.createStickerOnRef,disableButton:v,handleEmotionClick:n.handleEmotionClick,handleStickerPopoverOpen:n.handleStickerPopoverOpen,handleStickerPopoverClose:n.handleStickerPopoverClose,stickerIconActive:u,sticker:m,stickers:r,resetStickers:n.resetStickers,addSticker:n.addSticker}))))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"trackCommentCheckClick",value:function(e){var t=this.props.autoCheckAb;A.default.trackEvent(null,{id:7497,action:"Click",path:[{module_name:"1"===t?"图文弹窗":"文字弹窗"}]},{button:{text:e}})}},{key:"componentDidMount",value:function(){this.initLocalComment(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,a=e.ownerAuthorIsOrg,i=e.ownerAuthorIsBrand,s=e.autoCheckAb,c=this.state,l=c.active,m=c.hasNoContent,u=c.submitting,d=c.showCommentCheckModal,b=a?"机构":"作者",h={preset:"primary",color:"blue",children:"发布",disabled:m||u};if(t&&t.author){var f=z()(ye(),t.author.member.name,n?"，评论由".concat(b,"筛选后公开"):"");return Object(p.b)("div",{className:j()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":l||!m})},this.renderInput({placeholder:f}),Object(p.b)(V.c,Object(r.default)({},h,{className:"CommentEditorV2-singleButton",onClick:this.handleButtonSubmit})))}var v="写下你的评论...";return n&&(v=i?"已开启预审评论，评论由品牌筛选后公开":a?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),Object(p.b)("div",null,Object(p.b)("div",{className:j()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":l||!m})},this.renderInput({placeholder:v}),Object(p.b)(V.c,Object(r.default)({},h,{className:"CommentEditorV2-singleButton",onClick:this.handleButtonSubmit}))),d&&Object(p.b)(ve,{noBanner:"1"!==s,onClose:this.handleCheckClosed,onSubmit:this.handleCommentCheck}))}}]),t}(b.Component),je.propTypes={className:v.a.string,defaultActive:v.a.bool,replyTo:v.a.object,inCommentItem:v.a.bool,commentNeedsReview:v.a.bool,canComment:v.a.object,onCancel:v.a.func,onSubmit:v.a.func.isRequired,zaInfo:v.a.object},je.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1,zaInfo:{}},je.contextTypes={authRequired:v.a.func,realNameRequired:v.a.func},Oe=ge))||Oe)||Oe),Se=n(2273),Pe=n(589),Te=n(2283),De=n(55),Le=n(951),Fe=n(2229),xe=n(948),Be=n(2232),Ee=n(2233),Me=n(952),Ae=n(2234),qe=n(950),ze=n(2231),Ue=n(403),_e=n(100),Ve=n(316),We=n(133),He=n(56),Ge=n(265),Ke=n(139),Je=(n(2316),function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={previewImg:null},n.handlePreview=function(e){var t=e.target,o=n.props.onPreviewImage;"function"==typeof o?o(e).catch(function(){n.setState({previewImg:t})}):n.setState({previewImg:t})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imgNode=this.root.getElementsByClassName("origin_image zh-lightbox-thumb"),this.imagesNodes=Array.from([].concat(Object(x.a)(this.imagesGifNode),Object(x.a)(this.imagesNode),Object(x.a)(this.imagesStickerNode),Object(x.a)(this.imgNode))).map(function(t){var n=t.dataset||{},o=n.width,a=n.height,i=n.rawwidth,r=n.rawheight,s=Number(o||i),c=Number(a||r),l=document.createElement("div");l.className="Richtext-content_img",t.parentNode.replaceChild(l,t);var m=t.getAttribute("href")||t.getAttribute("src"),u=new Image,d=t.getAttribute("class");return"comment_sticker"!==d&&l.addEventListener("click",e.handlePreview),u.className=d,u.src=m,u.dataset.original=Object(ce.imgUrl)(m,"r"),u.dataset.rawwidth=s,u.onload=function(){s===c||"comment_sticker"===d?l.classList.add("Richtext-content_img-square"):s>c?l.classList.add("Richtext-content_img-square--wideShape"):l.classList.add("Richtext-content_img-square--highShape"),l.appendChild(u)},l})}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach(function(e){Object(E.unmountComponentAtNode)(e)})}},{key:"componentDidMount",value:function(){this.mount()}},{key:"componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props,o=n.html,a=n.className;return Object(p.b)("div",{className:j()("CommentRichText",a),ref:function(t){return e.root=t}},Object(p.b)(Ke.a,{html:o}),t&&Object(p.b)(Ge.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}}))}}]),t}(b.Component)),Ze=(n(2317),ke=Object(C.connect)(function(e){return{isWechat:e.env.userAgent.Wechat,permission:Object(D.c)(e)}}),Object(M.withRouter)(Ie=ke((we=Ne=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={reportModalShown:!1,isReplying:!1,guideShown:!1,deleteModal:!1},n.toggleReply=n.context.authRequired(function(){n.setState({isReplying:!n.state.isReplying})},void 0,R.b),n.openReportModal=n.context.authRequired(function(){n.setState({reportModalShown:!0})}),n.like=n.context.authRequired(function(e){var t=n.props;(0,t.onLike)(t.comment.id,e)},ee.E.like,R.b),n.dislike=n.context.authRequired(function(){var e=n.props;(0,e.onDislike)(e.comment.id)},ee.E.like,R.b),n.delete=function(){var e=n.props;return(0,e.onDelete)(e.comment.id)},n.feature=function(e){var t=n.props,o=t.onFeature,a=t.comment.id;o(e?"".concat(a,"_featured"):a)},n.collapse=function(){var e=n.props;(0,e.onCollapse)(e.comment.id)},n.approve=function(){var e=n.props;(0,e.onApprove)(e.comment.id)},n.reject=function(){var e=n.props;(0,e.onReject)(e.comment.id)},n.showConversation=function(e){var t=n.props;(0,t.onShowConversation)({commentId:t.comment.id,isAnchorComments:e})},n.stopReply=function(){n.setState({isReplying:!1})},n.closeReportModal=function(e){if(e){var t=e.result.payload,o=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?Ve.b.showModal({reportText:o}):Object(_e.b)(o||"举报成功")}n.setState({reportModalShown:!1})},n.handleToggleGuide=function(){n.setState({guideShown:!n.state.guideShown})},n.handleCloseDelete=function(){return n.setState({deleteModal:!1})},n.handleDelete=function(){return n.setState({deleteModal:!0})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:Object(p.b)("span",{className:"CommentItemV2-roleInfo"},"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) ")}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,a=void 0===o?{}:o,i=t.role;return Object(p.b)(h.a.Fragment,null,Object(p.b)("span",{className:"CommentItemV2-reply"},"回复"),Object(p.b)(He.a,{noBadge:!0,noHoverCard:!0,user:a}),this.renderRoleInfo(i,n))}},{key:"renderItem",value:function(){var e,t=this,n=this.props,o=n.isConversation,a=n.ownerAuthorIsOrg,i=n.parent,s=i.canComment,c=(s=void 0===s?{status:!0}:s).status,l=i.questionType,m=n.commentNeedsReview,u=n.comment,d=n.onReply,b=n.status,f=n.type,v=n.canOperate,C=n.commentPattern,O=n.rootCommentId,g=n.byComment,y=n.isReverseAndStatusOpen,k=n.hasRecommend,I=n.permission.canBrandAdminEdit,N=n.showCollapsed,w=this.state,R=w.reportModalShown,S=w.isReplying,P=u.id,T=u.author,D=u.content,L=u.voteCount,F=u.replyToAuthor,x=u.isAuthor,B=u.createdTime,E=u.featured,M=u.voting,A=u.reviewing,q=u.disliked,z=u.resourceType,U=u.childCommentCount,_=u.allowDelete,W=u.allowVote,H=u.canRecommend,G=u.canCollapse,K=u.collapsedReason,J=void 0===K?"":K,Z=u.isDelete,Q=u.collapsed,Y=Q&&!N,$=Y?"该评论已被折叠":Z?function(e){var t=e.content,n=e.deleteReason;if(n){var o=JSON.stringify({button:{text:String(n.reasonId)}}).replace(/"/g,"&quot;");return'<a href="'.concat(n.url,'" target="_blank" data-za-detail-view-id="7641" data-za-extra="').concat(o,'">').concat(n.tip,"</a>")}return t}(u):D,X=Z||Y,ee=T||{},te=ee.member,ne=ee.role,oe=Boolean(F),ae=E&&(U>0||oe)&&!o||g&&oe||y&&oe,ie=x||_&&("question"!==f||"commercial"===l),re=Object(p.b)("div",{className:"CommentItemV2-footer"},Object(p.b)(V.c,{className:j()("CommentItemV2-likeBtn",M&&"is-liked"),preset:"plain",onClick:this.like,disabled:x||!c},Object(p.b)(Le.a,{style:{marginRight:5},center:!0,size:16}),L>0?L:"赞"),Q&&J&&Object(p.b)("div",{className:"CommentItemV2-walleTag"},"阴阳怪气自动折叠"===J&&Object(p.b)(Fe.a,{size:16,className:"CommentItemV2-walleIcon"}),J),ae&&Object(p.b)(V.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return t.showConversation(oe)}},Object(p.b)(xe.a,{style:{marginRight:5},center:!0,size:16}),"查看回复"),!x&&c&&!Q&&Object(p.b)(V.c,{preset:"plain",className:j()({"CommentItemV2-hoverBtn":!S}),onClick:this.toggleReply},Object(p.b)(Be.a,{style:{marginRight:5},center:!0,size:16}),S?"取消回复":"回复"),H&&!k&&v&&Object(p.b)(V.c,{className:j()({"CommentItemV2-hoverBtn":!x&&!S}),preset:"plain",onClick:function(){return t.feature(E)}},Object(p.b)(Ee.a,{style:{marginRight:5},center:!0,size:16}),E?"取消推荐":"推荐"),G&&!x&&Object(p.b)(V.c,{className:j()({"CommentItemV2-hoverBtn":!x&&!S}),preset:"plain",onClick:this.collapse},Object(p.b)(Me.a,{style:{marginRight:5},center:!0,size:14}),Q?"取消折叠":"折叠"),W&&!x&&v&&Object(p.b)(V.c,{className:j()({"CommentItemV2-hoverBtn":!S}),preset:"plain",onClick:this.dislike,disabled:!c},Object(p.b)(Le.a,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),q?"取消踩":"踩"),x||Object(p.b)(h.a.Fragment,null,Object(p.b)(V.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.openReportModal},Object(p.b)(Ae.a,{style:{marginRight:5},center:!0,size:16}),"举报"),"question"===f&&"commercial"===l&&I&&Object(p.b)(V.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.reject},Object(p.b)(Me.a,{style:{marginRight:5},center:!0,size:16}),"隐藏")),ie&&Object(p.b)(V.c,{className:j()({"CommentItemV2-hoverBtn":!x&&!S&&!S}),preset:"plain",onClick:this.handleDelete},Object(p.b)(qe.a,{style:{marginRight:5},center:!0,size:16}),"删除"),Object(p.b)(Ve.a,{shown:this.state.deleteModal,id:P,onDelete:this.delete,onClose:this.handleCloseDelete}),Object(p.b)(We.b,Object(r.default)({type:"comment",urlToken:P,shown:R,onClose:this.closeReportModal},ie&&{onDeleteComment:this.delete},{notification:{failure:Ue.a},zaEnabled:!0})));return e=S?Object(p.b)("div",null,re,Object(p.b)(Re,{type:"comment",id:P,commentNeedsReview:m,className:"CommentItemV2-editor",defaultActive:!0,replyTo:u,onCancel:this.stopReply,onSubmit:d,rootCommentId:O,isConversation:o})):"reviewing"===b?Object(p.b)("div",{className:"CommentItemV2-footer"},Object(p.b)(V.c,{preset:"plain",onClick:this.approve},Object(p.b)(ze.a,{style:{marginRight:5},center:!0,size:14}),"公开"),Object(p.b)(V.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.handleDelete},Object(p.b)(qe.a,{style:{marginRight:5},center:!0,size:16}),"删除"),Object(p.b)(Ve.a,{shown:this.state.deleteModal,id:P,onDelete:this.delete,onClose:this.handleCloseDelete})):re,Object(p.b)("div",null,Object(p.b)("div",{className:"CommentItemV2-meta"},te&&Object(p.b)(He.a,{className:"CommentItemV2-avatar",avatar:!0,noHoverCard:"fixed"===C,user:te}),te&&Object(p.b)(He.a,{noBadge:!0,noHoverCard:!0,user:te}),this.renderRoleInfo(ne,z),this.renderReplyTo(),A&&Object(p.b)(Me.a,{className:"CommentItemV2-reviewing","data-tooltip":"".concat(!1===a?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),center:!0,size:14}),Object(p.b)("span",{className:"CommentItemV2-time"},Object(De.toRelativeString)(B))),Object(p.b)("div",{className:"CommentItemV2-metaSibling"},Object(p.b)(Je,{className:j()("CommentItemV2-content",{"CommentItemV2-shield":X}),html:$}),!X&&e))}},{key:"render",value:function(){return this.renderItem()&&Object(p.b)("div",{className:"CommentItemV2",ref:this.props.onRef},this.renderItem())}}]),t}(b.Component),Ne.propTypes={comment:v.a.object.isRequired,parent:v.a.object.isRequired,commentNeedsReview:v.a.bool,type:v.a.string,isConversation:v.a.bool,onLike:v.a.func.isRequired,onShowConversation:v.a.func,onReply:v.a.func,onFeature:v.a.func,onDelete:v.a.func.isRequired,onCollapse:v.a.func,commentPattern:v.a.string,showCollapsed:v.a.bool},Ne.contextTypes={currentUser:v.a.object,authRequired:v.a.func},Ie=we))||Ie)||Ie),Qe=n(3),Ye=(n(2318),5),$e=2,Xe=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={},n.handleClick=function(){var e=n.props,t=e.loadRestComments,o=e.onShowConversation,a=e.comment,i=a.id,r=a.childCommentCount,s=r<=Ye&&r>$e;(s?t:o)({commentId:i}),s&&n.setState(Object(Qe.a)({},"hide_".concat(i),!0))},n.handleRef=function(e){var t=n.props.onRef;"function"==typeof t&&t(e)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,a=e.isFetching,i=e.className,r=this.state["hide_".concat(n)],s=o<=Ye&&o>$e?"展开其他 ".concat(o-$e," 条回复"):"查看全部 ".concat(o," 条回复");return Object(p.b)("div",{className:i,ref:this.handleRef},!r&&Object(p.b)("div",{className:"CommentMoreReplyButton"},Object(p.b)(V.c,{preset:"plain",onClick:this.handleClick},s)),a&&Object(p.b)(I.a,{className:"CommentMoreReplyButton",small:!0}))}}]),t}(b.Component);Xe.propTypes={comment:v.a.object.isRequired,isFetching:v.a.bool,onShowConversation:v.a.func,loadRestComments:v.a.func};n(2319);var et,tt=Object(C.connect)(null,{loadConversation:g.g})(et=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).loadRestComments=function(e){var t=e.commentId;(0,n.props.loadConversation)({id:t,isLoadRest:!0})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author,a=(o=void 0===o?{isOrg:!1}:o).isOrg,i=e.parent,r=e.commentNeedsReview,s=e.onShowConversation,c=e.status,l=e.onItemLike,m=e.onItemDelete,u=e.onItemCollapse,d=e.onItemDislike,h=e.onItemApprove,f=e.onItemReject,v=e.canOperateItem,C=e.commentPattern,O=e.conversation,g=void 0===O?{}:O,y=e.entities,k=e.byComment,I=e.isReverseAndStatusOpen,N=e.comment,w=e.onReply,R=e.onFeature,S=e.ids,P=e.showCollapsed,T=N.id,D=N.featured,L=N.childComments,F=void 0===L?[]:L,x=N.childCommentCount,B=void 0===x?0:x,E=D?"".concat(T,"_featured"):"".concat(T),M=!D&&S.includes("".concat(T,"_featured")),A=Boolean(F.length)&&!I,q=B<=5&&B>2,z=F.map(function(e){return y.comments[e]}),U=!D&&B>2&&!I,_=(q&&g[T]||{isFetching:!1}).isFetching;return Object(p.b)(b.Fragment,null,Object(p.b)("li",{className:j()({"NestComment--rootCommentNoChild":!A,"NestComment--rootComment":A}),key:E},Object(p.b)(Ze,{key:E,comment:N,status:c,type:n,parent:i,canOperate:v,commentNeedsReview:r,onShowConversation:s,ownerAuthorIsOrg:a,onLike:l,onReply:w,onFeature:R,onDelete:m,onCollapse:u,onDislike:d,onApprove:h,onReject:f,commentPattern:C,rootCommentId:T,byComment:k,isReverseAndStatusOpen:I,hasRecommend:M,showCollapsed:P})),A&&z.map(function(e){var t=e.id,o=e.featured,b=o?"".concat(t,"_featured"):"".concat(t),O=!o&&S.includes("".concat(t,"_featured"));return Object(p.b)("li",{className:"NestComment--child",key:b},Object(p.b)(Ze,{key:b,comment:e,status:c,type:n,parent:i,canOperate:v,commentNeedsReview:r,onShowConversation:s,ownerAuthorIsOrg:a,onLike:l,onReply:w,onFeature:R,onDelete:m,onCollapse:u,onDislike:d,onApprove:h,onReject:f,commentPattern:C,rootCommentId:T,hasRecommend:O,showCollapsed:P}))}),U&&Object(p.b)(Xe,{comment:N,isFetching:_,onShowConversation:s,loadRestComments:this.loadRestComments}))}}]),t}(b.Component))||et;function nt(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var a=n.featured,i=n.replyToAuthor,r=n.id;return t===r&&a?i?{type:"replyToSubFeatured"}:{type:"replyToFeatured"}:t!==r||i?t!==r&&i?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}n(2320);var ot,at,it,rt=Object(C.connect)(function(e,t){var n=t.parent,o=t.parent,a=o.type,i=o.id,r=t.status,s=t.order,c=t.byComment,l=t.commentPattern,m=t.notificationId,u=e.entities,d=e.commentsV2,p=e.commentsV2,b=p.conversation,h=p.stickers,f=void 0===h?[]:h,v=p.commentWithPicPermission,C=p.notificationsComments,O="".concat(a,"_").concat(i),j=d.parent,g=u.comments[c],y=d.pagination;"reviewing"===r&&(y=d.reviewing);var I="reverse"===s&&"open"===r;I&&(y=d.reverse);var N=[],w=d.collapsed[O]||{};w.ids&&w.ids.length>0&&(N=w.ids.map(function(e){return u.comments[e]}));m&&(y=C,O=m);var R=y[O]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},S=R.isFetching,P=R.isPrevDrained,L=R.isDrained,F=R.ids,x=R.newIds,B=void 0===x?[]:x,E=R.totals,M="bottom"!==l?F:B,A=M.map(function(e){return u.comments[e]}),q=k()(M,function(e){return String(e).includes("_featured")});return{currentUser:Object(T.c)(e),isFetching:S,isPrevDrained:P,isDrained:L,totals:m?A.length:E,collapsedInfo:w,collapsedComments:N,targetComment:g,conversation:b,entities:u,stickers:f,lastFeaturedIndex:q,comments:A,isReverseAndStatusOpen:I,commentWithPicPermission:v,ids:M,parent:Object.assign({},n,{},j[O]),permission:Object(D.c)(e)}},{loadComments:g.f,loadConversation:g.g,addComment:g.a,loadStickers:g.j,clearNotification:R.d,getCommentWithPicPermission:g.e,loadNotificationComments:g.i,loadAnswerCommentPermission:S.c,loadArticleCommentPermission:P.b})((it=at=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={collapsed:!0,current:1},n.commentsWithPaginationElRef=h.a.createRef(),n.load=function(e,t,o){if(!n.props.isFetching&&!n.props.parent.adminClosedComment){var a=e||n.props,i=a.order,r=a.status,s=a.parent,c=s.id,l=s.type,m=a.commentPattern,u=a.needLoadCommentPermission,d=a.loadComments,p=a.notificationId,b=a.loadNotificationComments;if(p)return b(p);if(u&&n.loadCommentPermission(l,c),o){d(l,c,{order:i,isPrevious:t,status:"collapsed",commentPattern:m},!0)}else d(l,c,{order:i,isPrevious:t,status:r,commentPattern:m})}},n.addComment=function(e,t,o,a,i){var r=o.rootCommentId,s=o.isConversation,c=n.props,l=c.parent,m=l.id,u=l.type,d=c.commentId,p=c.addComment,b=c.notificationId;return p({parentType:u,parentId:m,content:e,replyTo:t,conversationId:d,rootCommentId:r,isConversation:s,notificationId:b,replyType:nt({id:r,replyTo:t,isConversation:s,isNotification:Boolean(b)}).type,useStrictMode:a,enableUnfriendlyCheck:i})},n.featureItem=function(e){(0,n.props.onItemFeature)(e,n.lastFeaturedIndex)},n.handleOpenCollapsed=function(){n.setState({collapsed:!1}),n.load(n.props,!1,!0)},n.handlePageSelect=function(e){var t=n.props.onPaginationClick,o=n.state.current;t&&t(o,e),n.commentsElement.scrollIntoView(),n.setState({current:e}),n.loadByPagination(e)},n.loadByPagination=function(e,t){var o=t||n.props,a=o.order,i=o.status,r=o.parent,s=r.id,c=r.type,l=o.commentPattern,m=o.needLoadCommentPermission,u=o.loadComments;m&&n.loadCommentPermission(c,s),u(c,s,{order:a,isPrevious:!1,status:i,commentPattern:l,current:e})},n.renderComment=function(e){var t=e.id,o=e.featured?"".concat(t,"_featured"):t,a=!n.state.collapsed;return Object(p.b)("ul",{className:"NestComment",key:o},Object(p.b)(tt,Object(r.default)({comment:e,onReply:n.addComment,onFeature:n.featureItem,showCollapsed:a},n.props)))},n.renderNormalComments=function(e){var t=n.state.collapsed,o=n.props,a=o.byComment,i=o.lastFeaturedIndex,r=o.parent,s=r.featuredCounts,c=r.commonCounts,l=[],m=s>0;return n.lastFeaturedIndex=0,e.length>0&&e.forEach(function(o,r){if(a||!o.collapsed){var u=e[r-1];o.collapsed&&(u&&u.collapsed||l.push(n.renderCollapsedDivider()),t)||(r===i&&l.push(Object(p.b)("div",{className:"NestComment-nextSiblings--noBorder",key:"NestComment-nextSiblings--noBorder"})),m&&0===r&&-1!==i&&l.push(Object(p.b)("div",{className:"CommentListV2-header-divider",key:"divider-featured"},"精选评论（",s,"）")),l.push(n.renderComment(o)),r===i&&(n.lastFeaturedIndex=r,l.push(Object(p.b)("div",{className:"CommentListV2-header-divider",key:"divider-comment"},"评论（",c,"）"))))}}),l},n.renderCollapsedComments=function(){var e=n.props,t=e.collapsedComments,o=e.isDrained,a=e.parent,i=(a=void 0===a?{}:a).collapsedCounts;return!o||i<=0?[]:t.map(function(e){return n.renderComment(e)})},n.renderComments=function(e){return e.map(n.renderComment)},n.renderCollapsedDivider=function(){var e=n.props,t=e.isDrained,o=e.parent.collapsedCounts;return!t||o<=0?[]:n.state.collapsed?Object(p.b)("div",{className:"CommentListV2-action",key:"collapsed"},Object(p.b)("div",{className:"CommentListV2-expendCollapseButton"},Object(p.b)("span",{onClick:n.handleOpenCollapsed},Object(w.formatNumber)(o)," 条评论被折叠"),"（",Object(p.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):Object(p.b)("div",{className:"CommentListV2-divider",key:"divider-collapsed"},Object(p.b)("div",{className:"CommentListV2-dividerLine"}),Object(p.b)("div",{className:"CommentListV2-dividerText"},Object(w.formatNumber)(o)," 条评论被折叠（",Object(p.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},n.renderCollapsedInfiLoader=function(){var e=n.state.collapsed;if(e)return[];var t=n.props.collapsedInfo,o=(t=void 0===t?{}:t).isFetching,a=t.isPrevDrained,i=t.isDrained;return Object(p.b)(I.b,{className:"CommentListV2",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:o,isPrevDrained:a,isDrained:i,onLoad:function(t){return n.load(n.props,t,!e)},placeholder:Object(p.b)(I.a,{className:"CommentItem",small:!0})},n.renderCollapsedComments())},n.renderPatternContent=function(e){var t=n.props,o=t.isFetching,a=t.parent.adminClosedComment,i=t.byComment,r=t.status,s=t.order,c=t.totals,l=t.showPackupButton,m=t.handlePackupButton,u=Math.ceil(c/20),d=n.state.current;return a?null:o?Object(p.b)(Se.a,null):Object(p.b)("div",{ref:n.commentsWithPaginationElRef},Object(p.b)("div",{className:"CommentListV2"},"normal"===s&&"open"===r?n.renderNormalComments(e):n.renderComments(e)),u>1&&Object(p.b)(N.a,{className:"CommentsV2-pagination",current:d,total:u,onSelect:n.handlePageSelect}),!i&&n.renderCollapsedDivider(),!i&&n.renderCollapsedInfiLoader(),l&&Object(p.b)(Te.a,{onClick:m,commentsElRef:n.commentsWithPaginationElRef}))},n.renderModalContent=function(e){var t=n.props,o=t.collapsedInfo,a=t.parent.adminClosedComment,i=t.status,s=t.order,c=t.byComment,l=n.state.collapsed,m=l?n.props:o,u=m.isFetching,d=m.isDrained,b=m.isPrevDrained;if(d&&e.length<=0||a)return Object(p.b)("div",{className:"CommentsV2-empty"},Object(p.b)(L.d,null,Object(p.b)(L.a,null),Object(p.b)("div",null,"还没有评论")));return Object(p.b)(I.b,Object(r.default)({className:"CommentListV2",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:b,isDrained:d,onLoad:function(e){return n.load(n.props,e,!l)},placeholder:Object(p.b)(I.a,{className:"CommentItemV2",small:!0})},{getContainer:function(e){return e}}),"normal"===s&&"open"===i?n.renderNormalComments(e):n.renderComments(e),!c&&n.renderCollapsedDivider(),!c&&n.renderCollapsedComments())},n.renderCommentEdit=function(){var e=n.props,t=e.parent,o=t.canComment,a=(o=void 0===o?{status:!0}:o).status,i=o.reason,r=t.author,s=(r=void 0===r?{isOrg:!1}:r).isOrg,c=t.type,l=t.id,m=t.adminClosedComment,u=t.questionType,d=e.byComment,b=e.autoFocus,h=e.commentNeedsReview,f=e.zaInfo,v=m?"当前内容暂时无法评论":i,C=b&&!d;return a&&!m?Object(p.b)(Re,{className:"CommentsV2-footer",type:c,id:l,commentNeedsReview:h,onSubmit:n.addComment,autoFocus:C,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===u,zaInfo:f}):Object(p.b)("div",{className:j()("CommentsV2-disabledText")},Object(p.b)("div",{className:"CommentsV2-disabledReason"},v))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,a=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return a(t);default:return null}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,a=e.loadStickers,i=e.getCommentWithPicPermission,r=e.commentWithPicPermission,s=e.currentUser,c=this.state.current;"bottom"!==t||n||this.loadByPagination(c),!o.length&&a(),void 0===r.commentWithPic&&s&&i()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,i=t.commentPattern;n===e.order&&o===e.status||("bottom"===i?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var r=e.targetComment;r!==a&&r&&this.setState({collapsed:r.collapsed})}},{key:"componentWillUnmount",value:function(){Object(R.d)(R.b)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.comments,a=t.commentPattern,i=t.commentInputPosition,s=t.isAuthor,c=t.parent,l=c.author,m=(l=void 0===l?{isOrg:!1}:l).isOrg,u=c.commentPermission,d=c.reviewingCounts,b=c.commentCount,h=c.adminClosedComment,f=t.totals,v=t.status,C=t.order,O=t.onStatusChange,g=t.onOrderChange,y=t.targetLink,k=t.shouldReverse,I=t.permission.canBrandAdminEdit,N="censor"===u&&(s||I),w=N?{isCommentReviewer:N,onStatusChange:O,status:v,reviewingCounts:d}:{status:v};return Object(p.b)("div",{className:j()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===a},n),ref:function(t){e.commentsElement=t}},Object(p.b)(Pe.a,Object(r.default)({commentCount:void 0!==b?b:f,shouldReverse:k,commentClosed:h,targetLink:y,order:C,onOrderChange:g,commentPattern:a,isOrg:m},w)),"top"===i&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(o):this.renderModalContent(o),"bottom"===i&&this.renderCommentEdit())}}]),t}(b.Component),at.propTypes={type:v.a.string,parent:v.a.object.isRequired,targetLink:v.a.node,commentNeedsReview:v.a.bool,byComment:v.a.oneOfType([v.a.number,v.a.string]),commentPattern:v.a.string,commentInputPosition:v.a.oneOf(["top","bottom"]),showPackupButton:v.a.bool,handlePackupButton:v.a.func,onPaginationClick:v.a.func,autoFocus:v.a.bool,shouldReverse:v.a.bool},at.contextTypes={authRequired:v.a.func.isRequired},at.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0,shouldReverse:!0},ot=it))||ot;var st,ct,lt,mt=n(110),ut=n.n(mt),dt=n(219),pt=n.n(dt),bt=n(2257),ht=Object(C.connect)(function(e,t){var n=t.conversationId,o=t.isAnchorComments,a=e.entities.comments,i=e.commentsV2,r=i.conversation,s=i.conversationMore,c=r[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=c.isFetching,m=c.isDrained,u=c.isPrevDrained,d=c.ids,p=c.totals,b=c.topComments,h=(b=void 0===b?{}:b).paging,f=(h||{}).isEnd,v=s[n]||{isFetching:!1,isDrained:!1,ids:[]},C=v.isFetching,O=v.isDrained,j=v.ids,g=j.map(function(e){return a[e]}),y=d.map(function(e){return a[e]}),k=a["".concat(n,"_featured")]||a[n]||{},I=o?pt()(j.length?[].concat(Object(x.a)(y.slice(0,4)),Object(x.a)(g),Object(x.a)(y.slice(4))):y,"id"):[k].concat(Object(x.a)(y)),N=h?[].concat(Object(x.a)(y.slice(0,3)),Object(x.a)(g)).length:-1;return{isFetching:l,isDrained:m,isPrevDrained:u,totals:p,comments:I,openComment:k,topCommentsPaging:h,isConversationMoreFetching:C,isConversationMoreDrained:f||O,offsetIndex:N}},{loadConversation:g.g,addComment:g.a,loadMoreAnchorComments:g.h})((lt=ct=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).load=function(){var e=n.props,t=e.isAnchorComments,o=e.conversationId;(0,e.loadConversation)({id:o,isAnchorComments:t})},n.addComment=function(e,t,o){var a=o.rootCommentId,i=o.isConversation,r=n.props,s=r.parent,c=s.type,l=s.id,m=r.conversationId,u=r.addComment,d=r.isAnchorComments;return u({parentType:c,parentId:l,content:e,replyTo:t,conversationId:m,rootCommentId:a,isConversation:i,replyType:nt({id:a,replyTo:t,isConversation:i}).type,isAnchorComments:d})},n.loadMoreAnchorComments=function(){var e=n.props,t=e.conversationId,o=e.topCommentsPaging,a=void 0===o?{}:o;(0,e.loadMoreAnchorComments)({conversationId:t,nextUrl:a.next})},n.createOnRef=ut()(function(e){return function(t){var o=n.props.byComment;parseInt(e)===Number(o)&&(n.targetCommentEl=t)}}),n.scrollToTarget=function(){var e=Object(B.default)(n),t=e.targetCommentEl,o=e.listEl;if(o&&t){var a=t.getBoundingClientRect(),i=a.top,r=a.height,s=o.getBoundingClientRect(),c=s.top,l=s.height;n.listEl.scrollTop+=i-c-(l-r)/2,t.classList.add("CommentItemV2--highlighted"),setTimeout(function(){return t.classList.remove("CommentItemV2--highlighted")},2e3),t.tabIndex=-1,t.focus()}},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,a=t.onItemFeature,i=t.onItemApprove,r=t.onItemCollapse,s=t.onItemDislike,c=t.onNavBack,l=t.canOperateItem,m=t.isFetching,u=t.comments,d=void 0===u?[]:u,h=t.commentNeedsReview,f=t.openComment.collapsed,v=t.parent,C=t.commentPattern,O=t.totals,j=t.isDrained,g=t.isPrevDrained,y=t.isConversationMoreFetching,k=t.isConversationMoreDrained,N=t.offsetIndex,w=null;return m&&!d.length?w=Object(p.b)(b.Fragment,null,Object(p.b)(I.a,{className:"CommentItemV2",small:!0}),Object(p.b)("div",{className:"CommentsV2-openComment-divider"}),Object(p.b)("div",{className:"CommentsV2-replyNum"},"".concat(O," 条回复"))):d.length&&(w=d.map(function(t,c){return c?k||c!==N||y?y&&c===N?Object(p.b)(b.Fragment,{key:t.id},Object(p.b)(Ze,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:l,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:i,onCollapse:r,onDislike:s,collapsedShown:f,onReply:e.addComment}),Object(p.b)(I.a,{key:"NestCoomment-moreCommentButton-PlaceHolder",className:"NestCoomment-moreCommentButton ",small:!0})):Object(p.b)(Ze,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:l,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:i,onCollapse:r,onDislike:s,collapsedShown:f,onReply:e.addComment}):Object(p.b)(b.Fragment,{key:t.id},Object(p.b)(Ze,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:l,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:i,onCollapse:r,onDislike:s,collapsedShown:f,onReply:e.addComment}),Object(p.b)("div",{key:"NestCoomment-moreCommentButton",preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments},Object(p.b)(bt.a,null),Object(p.b)("p",null,"点击查看更多回复"))):Object(p.b)(b.Fragment,{key:t.id},Object(p.b)("div",{className:"CommentsV2-openComment"},Object(p.b)(Ze,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:l,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:i,onCollapse:r,onDislike:s,collapsedShown:f,onReply:e.addComment})),Object(p.b)("div",{className:"CommentsV2-openComment-divider"}),Object(p.b)("div",{key:"".concat(t.id,"-title")},Object(p.b)("div",{className:"CommentsV2-replyNum"},"".concat(O," 条回复"))))})),"bottom"===C?Object(p.b)(fe.b,{size:"fullPage",onClose:c},Object(p.b)("div",{className:"CommentsV2"},Object(p.b)(Pe.a,{isConversation:!0,commentPattern:C}),Object(p.b)(I.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:m,isDrained:j,isPrevDrained:g,onLoad:this.load,placeholder:Object(p.b)(I.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},w))):Object(p.b)("div",{className:"CommentsV2"},Object(p.b)(Pe.a,{isConversation:!0,onNavBack:c}),Object(p.b)(I.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:m,isDrained:j,isPrevDrained:g,onLoad:this.load,placeholder:Object(p.b)(I.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},w))}}]),t}(b.Component),ct.propTypes={conversationId:v.a.number.isRequired,type:v.a.string,parent:v.a.object.isRequired,commentNeedsReview:v.a.bool},ct.contextTypes={currentUser:v.a.object,authRequired:v.a.func.isRequired},st=lt))||st;var ft,vt,Ct,Ot=n(71);n.d(t,"default",function(){return jt});var jt=Object(C.connect)(null,{updateCommentLikeStatus:g.o,updateCommentFeatureStatus:g.n,deleteComment:g.d,updateCommentCollapsed:g.l,updateCommentDisliked:g.m,approveComment:g.b,rejectComment:g.k})(ft=Object(Ot.a)(null)((Ct=vt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={openedCommentId:null,isAnchorComments:!1,status:"open",order:"normal"},n.showConversation=function(e){var t=e.commentId,o=e.isAnchorComments;n.setState({openedCommentId:t,isAnchorComments:o})},n.showComments=function(){n.setState({openedCommentId:null,isAnchorComments:!1})},n.delete=function(e){var t=n.props,o=t.parent;return(0,t.deleteComment)(e,o.type,o.id)},n.feature=function(e){var t=n.props,o=t.parent,a=t.updateCommentFeatureStatus,i=t.notificationId;a({id:n.state.openedCommentId,commentId:e,parentId:o.id,parentType:o.type,notificationId:i})},n.like=function(e,t){var o=n.props,a=o.onItemLike,i=o.updateCommentLikeStatus;a&&a(e,t),i(e)},n.collapse=function(e){var t=n.props,o=t.parent;(0,t.updateCommentCollapsed)(e,o.type,o.id)},n.dislike=function(e){(0,n.props.updateCommentDisliked)(e)},n.approve=function(e){var t=n.props,o=t.parent,a=t.type;(0,t.approveComment)(e,o.type||a,o.id)},n.reject=function(e){var t=n.props,o=t.parent,a=t.type;(0,t.rejectComment)(e,o.type||a,o.id)},n.handleStatusChange=function(e){n.setState({status:e})},n.handleOrderChange=function(e,t){var o=n.props.onOrderChange;o&&o(e,t),n.setState({order:e})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.containerClassName,a=t.parent,i=t.commentPattern,c=t.type,l=t.parent,m=(l=void 0===l?{}:l).commentPermission,u=l.relationship,d=void 0===u?{}:u,b=l.author,h=void 0===b?{}:b,f=t.needLoadCommentPermission,v=t.byComment,C=Object(s.a)(t,["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission","byComment"]),O=this.context.currentUser,g=void 0===d.isAuthor?O&&h.urlToken&&O.urlToken===h.urlToken:d.isAuthor,y="censor"===m&&!g,k="answer"===c||"article"===c,I=this.state,N=I.openedCommentId,w=I.status,R=I.order,S=I.isAnchorComments,P=S&&(N||v)||v;return Object(p.b)("div",{className:j()("Comments-container",o),ref:function(t){return e.commentsContainerNode=t}},Object(p.b)(rt,Object(r.default)({className:j()(n,{"CommentsV2--hidden":N&&"bottom"!==i})},C,{type:c,order:R,status:w,parent:a,commentPattern:i,commentNeedsReview:y,canOperateItem:k,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:P,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:f,isAuthor:g})),N&&Object(p.b)(ht,Object(r.default)({},C,{parent:a,type:c,canOperateItem:k,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:i,conversationId:N,onNavBack:this.showComments,byComment:P,isAnchorComments:S,commentNeedsReview:y,onShowConversation:this.showConversation})))}}]),t}(b.Component),vt.propTypes={type:v.a.string.isRequired,parent:v.a.object.isRequired,onOrderChange:v.a.func,onItemLike:v.a.func,isAuthor:v.a.bool,onMount:v.a.func},vt.defaultProps={type:"answer"},vt.contextTypes={currentUser:v.a.object,authRequired:v.a.func.isRequired},ft=Ct))||ft)||ft},2408:function(e,t,n){"use strict";n.r(t);var o=n(16),a=n(17),i=n(0),r=n(2),s=n.n(r),c=n(1),l=n(36),m=n(2274),u=function(e,t,n){return n&&void 0!==t&&(e||!t)},d=(n(135),n(9)),p=n(37),b=n(45),h=n.n(b),f=n(57),v=n(596),C=function(e){var t,n=e.onBack,o=e.onSubmit,r=e.authRequired,s=e.isActive,l=e.editItem,m=void 0===l?{}:l,b=e.isDefaultPage,C="edit"===e.currentPage,O=Object(c.useState)(null===(t=m.isPublic)||void 0===t||t),j=Object(a.a)(O,2),g=j[0],y=j[1],k=Object(c.useState)(m.title||""),I=Object(a.a)(k,2),N=I[0],w=I[1],R=Object(c.useState)(m.description||""),S=Object(a.a)(R,2),P=S[0],T=S[1],D=!N||N.length>20||P.length>60,L=C&&!0===m.isPublic&&m.followerCount>0;return Object(i.b)("form",{className:"Favlists-content",onSubmit:function(e){if(e.preventDefault(),N){var t={title:N,description:P,isPublic:g};u(g,s,r)?r(o)(t):(o(t),n())}}},Object(i.b)("div",{className:"Favlists-addItems"},Object(i.b)("div",{className:"Favlists-addItem"},Object(i.b)(f.a,{className:"Favlists-titleInput",placeholder:"收藏标题",onChange:function(e){w(e.target.value)},value:N}),Object(i.b)("div",{className:"Favlists-inputTips"},Object(i.b)(v.a,{name:"收藏标题",current:N?N.length:0,max:20}))),Object(i.b)("div",{className:"Favlists-addItem"},Object(i.b)(f.a,{multiline:!0,className:"Favlists-descritionInput",placeholder:"收藏描述（可选）",onChange:function(e){T(e.target.value)},rows:5,value:P}),Object(i.b)("div",{className:"Favlists-inputTips"},Object(i.b)(v.a,{name:"收藏描述",current:P?P.length:0,max:60}))),Object(i.b)("div",{className:"Favlists-addItem"},Object(i.b)("label",{className:"Favlists-privacyOption"},Object(i.b)("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"true",checked:g,onChange:function(){return y(!0)}}),Object(i.b)("span",null,"公开"),Object(i.b)("span",{className:"Favlists-privacyOptionTips"},"有其他人关注此收藏夹时不可设置为私密")),Object(i.b)("label",{className:h()("Favlists-privacyOption",{"Favlists-privacyOption--privacyDisable":L})},Object(i.b)("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"false",checked:!g,onChange:function(){return y(!1)},disabled:L}),Object(i.b)("span",null,"私密"),Object(i.b)("span",{className:"Favlists-privacyOptionTips"},L?"当前有人在关注此收藏夹，无法设为隐私":"只有你自己可以查看这个收藏夹")))),Object(i.b)(p.a,{direction:"horizontal",className:""},n&&Object(i.b)(d.c,{onClick:n},b?"取消":"返回"),Object(i.b)(d.c,{color:"blue",preset:"primary",type:"submit",disabled:D},b?"确认":"确认创建")))};C.propTypes={onSubmit:s.a.func.isRequired,onBack:s.a.func,authRequired:s.a.func,isActive:s.a.bool,editItem:s.a.shape({type:s.a.oneOf(["collection"])}),currentPage:s.a.oneOf(["edit","add"]),isDefaultPage:s.a.bool};var O=C,j=(n(2395),n(4)),g=n(8),y=n(7),k=n(5),I=n(6),N=n(65),w=n(193),R=n(11),S=n(2259),P=function(e){function t(){var e,n;Object(j.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(a)))).handleChange=function(){var e=n.props;(0,e.onChange)(e.id,n.props.checked)},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.zaEnabled,n=e.id;t&&R.default.setModule(this,{module:"CollectionItem"},{card:{card_type:"Content",content:{type:"Collection",token:String(n)}}})}},{key:"render",value:function(){var e=this.props,t=e.answerCount,n=e.title,a=e.isPublic,r=e.checked,s=void 0!==r&&r?{preset:"primary",color:"grey",children:"已收藏"}:{color:"blue",children:"收藏"};return Object(i.b)("div",{className:"Favlists-item"},Object(i.b)("div",{className:"Favlists-itemInner"},Object(i.b)("div",{className:"Favlists-itemName"},Object(i.b)("span",{className:"Favlists-itemNameText"},n),!1===a&&Object(i.b)("span",{className:"Favlists-itemIcon"},Object(i.b)(S.a,{size:16}))),Object(i.b)("div",{className:"Favlists-itemContent"},t," 条内容")),Object(i.b)(d.c,Object(o.default)({},s,{className:"Favlists-updateButton",onClick:this.handleChange})))}}]),t}(c.Component),T=function(e){function t(){var e,n;Object(j.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(y.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(a)))).items={},n.handleFavlistItemChange=function(e,t){R.default.trackEvent(n.items[e],{action:t?"UnCollect":"Collect",element:"Button",is_intent:!1}),n.props.onUpdate(e,t)},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.relations,a=t.items,r=t.isFetching,s=t.isDrained,c=t.onAdd,l=t.onLoad;return Object(i.b)("div",{className:"Favlists-content"},Object(i.b)(N.b,{isLocal:!0,isLoading:r,isDrained:s,onLoad:l,placeholder:Object(i.b)(w.a,{title:!0}),getContainer:function(e){return e},className:"Favlists-items"},a.map(function(t){return Object(i.b)(P,Object(o.default)({key:t.id,onChange:e.handleFavlistItemChange,checked:n[t.id]},t,{ref:function(n){e.items[t.id]=n}}))})),!a.length&&r||Object(i.b)("div",{className:"Favlists-actions"},Object(i.b)(d.c,{className:"Favlists-addButton",onClick:c,preset:"primary",color:"blue"},"创建收藏夹")))}}]),t}(c.Component);T.propTypes={isFetching:s.a.bool,relations:s.a.object,onUpdate:s.a.func.isRequired,onAdd:s.a.func.isRequired,onLoad:s.a.func.isRequired,items:s.a.array.isRequired,isDrained:s.a.bool,authRequired:s.a.func};var D=T,L=Object(c.forwardRef)(function(e,t){var n=e.currentPage,o=e.items,a=e.isFetching,r=e.isDrained,s=e.relations,c=e.handleUpdateFavList,l=e.onLoad,m=e.zaEnabled,u=e.handleAdd,b=e.handleCloseModal,h=e.onFavlistAdd,f=e.authRequired,v=e.isUserActive,C=e.defaultStatus,j=e.handleBack,g=e.hasFavlists,y=e.editItem,k=void 0===y?{}:y,I=e.onUpdateFavContent;if("list"===n)return g?Object(i.b)(D,{ref:t,items:o,isFetching:a,isDrained:r,relations:s,onAdd:u,onUpdate:c,onLoad:l,zaEnabled:m}):Object(i.b)(p.a,null,Object(i.b)(d.c,{preset:"primary",color:"blue",onClick:u},"创建收藏夹"),Object(i.b)(d.c,{onClick:b},"取消"));if(["add","edit"].includes(n)){var N=C===n;return Object(i.b)(O,{onSubmit:"add"===n?h:I,isActive:v,onBack:N?b:j,authRequired:f,editItem:k,currentPage:n,isDefaultPage:N})}return null});L.propTypes={currentPage:s.a.oneOf(["list","add","edit"]).isRequired,items:s.a.arrayOf(s.a.shape({type:s.a.oneOf(["collection"])})),isFetching:s.a.bool,isDrained:s.a.bool,relations:s.a.object,handleUpdateFavList:s.a.func,onLoad:s.a.func,zaEnabled:s.a.bool,handleAdd:s.a.func,handleCloseModal:s.a.func.isRequired,onFavlistAdd:s.a.func,authRequired:s.a.func,isUserActive:s.a.bool,defaultStatus:s.a.oneOf(["list","add","edit"]),handleBack:s.a.func,hasFavlists:s.a.bool,editItem:s.a.shape({type:s.a.oneOf(["collection"])}),onUpdateFavContent:s.a.func};var F=L,x=(n(2396),{list:{title:"添加收藏",tips:function(e){return e?"请选择你想添加的收藏夹":"你可以创建多个收藏夹，将答案分类收藏"}},add:{title:"创建新收藏夹"},edit:{title:"编辑收藏夹"}}),B=function(e){var t=e.shown,n=e.items,r=e.id,s=e.type,d=e.onFetchRelations,p=e.relations,b=e.onClose,h=e.isUserActive,f=e.authRequired,v=e.defaultStatus,C=e.onUpdateFav,O=e.isDrained,j=e.isFetching,g=e.onLoad,y=e.zaEnabled,k=e.onFavlistAdd,I=e.editItem,N=e.onUpdateFavContent,w=Object(c.useState)(v),R=Object(a.a)(w,2),S=R[0],P=R[1],T=Object(c.useRef)([]);Object(c.useEffect)(function(){if(d&&t&&n.length!==T.current.length){T.current=n;var e=(p?n.filter(function(e){return!p[e.id]}):n).map(function(e){return e.id});e.length&&d(r,s,e)}},[r,n,d,p,t,s]),Object(c.useEffect)(function(){"add"===S&&"list"===v&&T.current.length<n.length&&P("list")},[S,v,I,n]);var D=function(){b(),"list"===v&&P("list")},L=!(O&&!n.length),B=Object(m.a)(e,Object.keys(l.b.propTypes)).selectedProps,E=x[S],M=E.tips,A=E.title;return Object(i.b)(l.b,Object(o.default)({},B,{onClose:D,title:A,subtitle:M&&M(L),buttonGroupOnly:!L,className:"FavlistsModal",size:"large"}),t&&Object(i.b)(F,{currentPage:S,items:n,isFetching:j,isDrained:O,relations:p,handleUpdateFavList:function(e,t){var o=n.find(function(t){return t.id===e})||{},a=[e,r,s,o.isPublic];return!t&&u(o.isPublic,h,f)?f(C).apply(void 0,a):C.apply(void 0,a)},onLoad:g,zaEnabled:y,handleAdd:function(){return P("add")},handleCloseModal:D,onFavlistAdd:k,authRequired:f,isUserActive:h,defaultStatus:v,handleBack:function(){return P("list")},hasFavlists:L,editItem:I,onUpdateFavContent:N}))};B.propTypes={id:s.a.oneOfType([s.a.string,s.a.number]),type:s.a.oneOf(["answer","article","pin"]),relations:s.a.object,onUpdateFav:s.a.func,onFavlistAdd:s.a.func,onFetchRelations:s.a.func,onClose:s.a.func.isRequired,shown:s.a.bool,zaEnabled:s.a.bool,authRequired:s.a.func,isUserActive:s.a.bool,defaultStatus:s.a.oneOf(["list","add","edit"]),onLoad:s.a.func,editItem:s.a.shape({type:s.a.oneOf(["collection"])}),onUpdateFavContent:s.a.func},B.defaultProps={defaultStatus:"list",relations:{},authRequired:function(e){return e}};var E=B;n.d(t,"FavlistsModal",function(){return E})},2411:function(e,t,n){"use strict";n.r(t);var o=n(4),a=n(8),i=n(7),r=n(5),s=n(6),c=n(0),l=n(1),m=n.n(l),u=n(2),d=n.n(u),p=n(13),b=n.n(p),h=n(9),f=n(37),v=n(870),C=n(73),O=n(52),j=n(32),g=(n(2397),8),y=9,k=13,I=48,N=57;function w(e,t){return e?t?!0===t?"":t:e:""}var R=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).onInputFocus=n.onInputFocus.bind(Object(j.default)(n)),n.onInputChange=n.onInputChange.bind(Object(j.default)(n)),n.onKeyDown=n.onKeyDown.bind(Object(j.default)(n)),n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"onInputFocus",value:function(){this.props.onFocus()}},{key:"onInputChange",value:function(e){var t=String(e.target.value);if(t){t=t[t.length-1];var n=this.props.chars,o=this.props.length;n.length===o?n=n.replace(/.$/,t):n+=t,this.props.onChange(n),n.length===o&&this.props.onFinish(n)}}},{key:"onKeyDown",value:function(e){var t=e.keyCode;if(!e.metaKey&&!e.ctrlKey&&t!==y&&t!==k){var n=this.props.chars;t===g?(n=n.slice(0,-1),this.props.onChange(n)):(t<I||t>N)&&(e.preventDefault(),this.props.onError(e))}}},{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var e=this,t=this.props,n=t.length,o=t.chars,a=t.maskChar,i=t.autoFocus,r=t.className,s=t.children,l=o.length===n?n-1:o.length,m=o[l]||"";return Object(c.b)("label",{className:b()("TPass",r)},Object(c.b)("span",{className:"TPass-wrapper"},Object(c.b)(S,{length:n,chars:o,maskChar:a}),Object(c.b)("input",{className:"TPass-input",value:m,style:{left:60*l},onFocus:this.onInputFocus,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onPaste:function(e){return e.preventDefault()},type:"number",min:"0",max:"9",pattern:"[0-9]*",autoFocus:i,ref:function(t){e.input=t}})),s)}}]),t}(m.a.Component);function S(e){for(var t,n=e.length,o=e.chars,a=e.maskChar,i=[],r=0;r<n;r+=1)t=o[r],i.push(Object(c.b)("span",{className:b()("TPassBox",{"TPassBox-mask":t&&Boolean(a)}),key:r},w(t,a)));return Object(c.b)("span",{className:"TPassBoxes"},i)}R.defaultProps={length:6,chars:"",maskChar:!1,autoFocus:!1,onFocus:function(){},onChange:function(){},onError:function(){},onFinish:function(){}},R.propTypes={length:d.a.number,chars:d.a.string,maskChar:d.a.oneOfType([d.a.bool,d.a.string]),autoFocus:d.a.bool,onFocus:d.a.func,onChange:d.a.func,onError:d.a.func,onFinish:d.a.func,className:d.a.string,children:d.a.node};var P=R,T=(n(2398),function(e){function t(){return Object(o.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e=this.props;return Object(c.b)("div",{className:b()("Spinner",e)},Object(c.b)("i",{className:"Spinner-loading"}))}}]),t}(l.Component));T.propTypes={className:d.a.string};var D=n(134),L=(n(2399),11);function F(){this.payments={},this.chosePaymentName=null,this.codeUrl="",this.qrLoaded=!1,this.need=null,this.passcode="",this.needSMS=!1,this.smsTimer=0,this.isInProgress=!1,this.error=null}var x=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).onPasscodeFocus=function(){n.state.error&&(n.setState({error:null}),6===n.state.passcode.length&&n.setState({passcode:""}))},n.onPasscodeInput=function(e){"object"==typeof e&&(e=e.target.value),n.setState({passcode:e})},n.onPasscodeFinish=function(e){n.tpass.blur(),n.payWithBalance(e)},n.onSendSMSCode=function(){n.props.trade.resendSMSCode(function(){n.startSMSTimer(),n.smsInput.focus()},function(e){n.setState({error:e})})},n.onQrLoad=function(){n.setState({qrLoaded:!0})},n.onBalanceFormSubmit=function(e){e.preventDefault(),n.payWithBalance(n.state.passcode)},n.setPayments=function(e){n.setState({payments:e})},n.confirmPayment=function(){var e=n.state,t=e.choseName,o=e.payments,a=n.props.onConfirmPayment,i=t;if(t||(i=o.balance&&o.balance.enable?"balance":"wechat"),a(!i),n.setState({chosePaymentName:i}),"wechat"===i&&n.isInWechat){var r=n.props.tradeNumber,s="".concat(location.protocol,"//").concat(location.host).concat(location.pathname),c="".concat("https://www.zhihu.com/pay/weixin/pay?service_id=".concat(L)+"&trade_number=".concat(r,"&redirect_uri=").concat(encodeURIComponent(s)));window.location.replace(c)}else n.props.trade["wechat"===i?"initWechatPay":"initBalancePay"]()},n.pid=0,n.smsTimer=null,n.state=new F,n.isInWechat=e.ua.Wechat,n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.trade;this.getPaymentsList(e),this.initListeners(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.trade!==this.props.trade&&(this.setState(new F),setTimeout(function(){t.getPaymentsList(e.trade)},300),this.initListeners(e.trade))}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.smsTimer),this.props.trade.dispose()}},{key:"getPaymentsList",value:function(e){var t=this;if(e){var n=this.pid+=1;e.getPaymentsList(function(e){t.pid===n&&t.setPayments(e)})}}},{key:"initListeners",value:function(e){var t=this;e&&e.on("payInited",function(e,n){t.setState(Object.assign({},n))}).on("paySuccess",function(){t.setState({isInProgress:!1,error:null}),t.props.onSuccess()}).on("payCancel",function(){t.setState({isInProgress:!1,chosePaymentName:null})}).on("payFail",function(e){var n=e;"object"!=typeof e||e instanceof Error||(n=e.message),t.setState({isInProgress:!1,error:n}),t.props.onFail(e)}).on("needSMS",function(e){t.setState({isInProgress:!1,error:null,needSMS:e.message,passcode:""})}).on("needWechatCode",function(){t.props.onError("needWechatCode")}).on("error",function(e,n){t.props.onError(e,n)})}},{key:"startSMSTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;window.clearInterval(this.smsTimer),this.setState({smsTimer:t}),this.smsTimer=window.setInterval(function(){(t-=1)<=0?(window.clearInterval(e.smsTimer),e.smsTimer=null,e.setState({smsTimer:0})):e.setState({smsTimer:t})},1e3)}},{key:"payWithBalance",value:function(e){return 6!==e.length?(this.setState({error:"请输入 6 位支付密码"}),!1):(this.setState({isInProgress:!0,error:null}),this.props.trade.payWithBalance(e))}},{key:"renderPaymentsList",value:function(){var e=this,t=this.state,n=t.payments,o=t.chosePaymentName,a=t.choseName,i=this.props.trade;if(o)return null;var r=n.balance&&n.balance.amount,s=i.info.total,l=n.wechat&&n.wechat.enable,m=this.props.balanceEnable,u=n.balance&&n.balance.enable,d=n.balance&&!n.balance.enable,p=m&&r>=s,b="使用余额（剩余 ".concat((r/100).toFixed(2),"）"),f=p?b:"微信支付",v=p?"wallet":"wechatPayment";a&&(f="wechat"===a?"微信支付":b,v="wechat"===a?"wechatPayment":"wallet");var j=Object(c.b)("div",null,Object(c.b)(O.a,{name:v,className:"PaymentItem-".concat(v)}),Object(c.b)(h.c,{className:"Payment-Popover"},f),Object(c.b)(O.a,{className:"Select-arrow",name:"select"}));return Object(c.b)("div",{className:"PaymentsList"},Object(c.b)("span",{className:"Payment-Topline"}),Object(c.b)("span",{className:"PaymentWay"},"支付方式"),Object(c.b)(D.a,{placeholder:j},Object(c.b)(C.b,{plain:!0,className:"Payment-select",listClassName:"Payment-select-list",targetClassName:"Popover-targetContainer-verification",menuToggler:j,onChange:function(t){"disabled"!==t&&e.setState({choseName:t})}},m&&u&&Object(c.b)(C.a,{value:"balance",className:"PaymentItem"},Object(c.b)(O.a,{name:"wallet",className:"PaymentItem-wallet"}),b),m&&d&&Object(c.b)(C.a,{value:"disabled",className:"PaymentItem PaymentItem--disabled"},Object(c.b)(O.a,{name:"wallet",className:"PaymentItem-wallet"}),b),l&&Object(c.b)(C.a,{value:"wechat",className:"PaymentItem"},Object(c.b)(O.a,{name:"wechatPayment",className:"PaymentItem-wechatPayment"}),"微信支付"))),Object(c.b)("span",{className:"Payment-Bottomline"}),Object(c.b)(h.c,{className:"Payment-CheckedButton",onClick:this.confirmPayment},"确认支付"))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.trade,a=this.state,i=a.payments,r=a.chosePaymentName,s=a.codeUrl,l=a.needSMS,m=a.isInProgress;return o?Object(c.b)("div",{className:b()("Payment",n)},Object.keys(i).length?this.renderPaymentsList():Object(c.b)("div",{className:"Payment-placeholder"},Object(c.b)(T,null)),"wechat"===r&&Object(c.b)("div",{className:"Payment-wechatPay"},Object(c.b)("div",{className:"Payment-wechatPayTitle"},Object(c.b)("i",{className:"icon icon-ic_wechatpay PaymentIconWechat"}),"微信支付"),!this.isInWechat&&Object(c.b)("div",null,"使用微信扫描二维码完成支付"),this.state.qrLoaded?Object(c.b)("span",{className:"Payment-qrWrapper"},Object(c.b)("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url=".concat(s),width:"150",height:"150"})):Object(c.b)("div",{className:"Payment-qrPlaceholder"},Object(c.b)(T,null),!this.isInWechat&&Object(c.b)("div",null,"正在生成二维码"),s&&Object(c.b)("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url=".concat(s),width:"1",height:"1",onLoad:this.onQrLoad}))),"balance"===r&&Object(c.b)("form",{onSubmit:this.onBalanceFormSubmit,className:"Payment-balancePay"},Object(c.b)("div",{className:"Payment-balancePayTitle"},Object(c.b)("i",{className:"icon icon-wallet PaymentIconWallet"}),"余额支付"),!l&&Object(c.b)("div",null,Object(c.b)("div",{className:"Payment-description"},"请输入 6 位数知乎支付密码，用于支付验证。"),Object(c.b)(P,{chars:this.state.passcode,onFocus:this.onPasscodeFocus,onChange:this.onPasscodeInput,maskChar:!0,onFinish:this.onPasscodeFinish,className:b()("Payment-tpass",{"Payment-errorInput":this.state.error,"Payment-progressing":m}),autoFocus:!0,ref:function(t){e.tpass=t}},m&&Object(c.b)(T,{className:"Payment-balancePaySpinner"}))),Boolean(l)&&Object(c.b)("div",{className:"Payment-balancePaySms"},Object(c.b)("div",{className:"Payment-balancePaySmsText"},String(l)),Object(c.b)("input",{onChange:this.onPasscodeInput,value:this.state.passcode,className:b()("Payment-sms","SimpleInput",{"Payment-errorInput":this.state.error}),type:"text",pattern:"\\d{6}",minLength:"6",maxLength:"6",title:"验证码应为 6 位数字",placeholder:"输入 6 位数验证码",required:!0,autoFocus:!0,ref:function(t){e.smsInput=t}}),this.state.smsTimer?Object(c.b)("button",{className:"Payment-sendSms",type:"button",disabled:!0},this.state.smsTimer," 秒后可重发"):Object(c.b)("button",{onClick:this.onSendSMSCode,className:"Payment-sendSms",type:"button"},"发送验证码")),Object(c.b)("div",{className:"Payment-balancePayFooter"},Object(c.b)("p",{className:"Payment-errorTip",style:{visibility:this.state.error?"visible":"hidden"}},this.state.error),Boolean(l)&&Object(c.b)(h.c,{color:"blue",disabled:m,className:"Payment-balancePayConfirmBtn",type:"submit"},"确认")),!l&&Object(c.b)("div",{className:"Payment-balancePayForget"},"如果忘记密码请邮件联系"," ",Object(c.b)("email",{className:"Payment-email"},"i@zhihu.com")))):Object(c.b)("div",{className:b()("Payment",n)},Object(c.b)("div",{className:"Payment-placeholder Payment-placehoder--empty"},Object(c.b)(T,null)))}}]),t}(m.a.Component);x.propTypes={trade:d.a.object,autoChooseSinglePayment:d.a.bool,onSuccess:d.a.func.isRequired,onFail:d.a.func,onError:d.a.func,onConfirmPayment:d.a.func,balanceEnable:d.a.bool},x.defaultProps={trade:null,onSuccess:function(){},onFail:function(){},onError:function(){},autoChooseSinglePayment:!0,className:"",balanceEnable:!0};var B=x,E=n(259),M="",A=null;var q=n(20);n(2400);n.d(t,"TipjarDialog",function(){return _});var z=[200,500,1e3,5e3,1e4,2e4],U=100,_=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).lockScroll=function(){document.body.classList.add("scroll-locked"),n.scrollTop=window.scrollY,document.body.style.width="100%",document.body.style.position="fixed",document.body.style.top=-n.scrollTop+"px"},n.unlockScroll=function(){document.body.classList.remove("scroll-locked"),document.body.style.width=null,document.body.style.position=null,void 0!==n.scrollTop&&(window.scrollTo(0,n.scrollTop),n.scrollTop=void 0),document.body.style.top=null},n.onConfirmPayment=function(e){n.setState({chosePaymentName:e})},n.onPaySuccess=function(){n.props.onPaySuccess(),n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:"",customButton:!1})},n.handleCustomAmount=function(){n.state.trade&&n.state.trade.dispose(),n.setState({showCustom:!0})},n.handleCustomChange=function(e){var t=e.target.value;isNaN(t)?n.setState({customAmount:""}):n.setState({customAmount:parseInt(t)||""})},n.handleCustomKeyUp=function(e){13===e.keyCode&&n.handleSubmitCustom()},n.handleSubmitCustom=function(){var e=n.state.customAmount*U;e>0&&e<=5e4&&(n.setState({customButton:!0,showCustom:!1,colseTijarDialogStatus:!1}),n.createTrade(e))},n.closeModal=function(){n.state.trade&&n.state.trade.dispose(),n.setState(n.getDefaultState())},n.handleAmountButton=function(e){n.createTrade(e.currentTarget.dataset.amount),n.setState({colseTijarDialogStatus:!1,customButton:!1,showCustom:!1})},n.createTrade=function(e){n.setState({tradeLoading:!0,currentAmount:e});var t=n.props.ua;n.props.addReward(e,t.Wechat?"wechat":"normal"),n.setState({tradeLoading:!1})},n.colseTijarDialog=function(){n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:""}),n.props.colseTijarDialog()},n.state=n.getDefaultState(),n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"componentDidMount",value:function(){this.showTip()}},{key:"componentDidUpdate",value:function(e){var t=e.TipjarRender,n=this.props,o=n.tradeNumber,a=n.type,i=n.isMobile,r=n.TipjarRender,s=this.state,c=s.trade,l=s.colseTijarDialogStatus,m="article"===a?11:17;if(o&&(!c||o!==c.tradeNo)&&!l){var u=new window.zhihu.pay.Trade(o,m);this.setState({trade:u})}i&&(!t&&r?this.lockScroll():t&&!r&&this.unlockScroll())}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.TipjarRender,n=e.isMobile;t&&this.props.removeTradeNumber(),t&&n&&this.unlockScroll()}},{key:"getDefaultState",value:function(){return{showCustom:!1,customAmount:"",currentAmount:"",showTipModal:!1,customButton:!1,chosePaymentName:!0,colseTijarDialogStatus:!1}}},{key:"showTip",value:function(){var e,t,n=this;e="https://pay.zhihu.com/api/js",t=function(){n.setState({showTipModal:!0})},M&&e&&e!==M&&t(new Error("A pay-sdk from different source has been load")),M=e,window.zhihu&&window.zhihu.pay?window.zhihu.pay.ready(t):(A||(A=Object(E.loadScript)(e)),A.then(function(){return window.zhihu.pay.ready(t)},function(e){t(e),A=null}))}},{key:"renderAmountCustom",value:function(){var e=this.state,t=e.showCustom,n=e.customAmount,o=e.currentAmount,a=e.customButton;return Object(c.b)("div",{className:"Reward-TipjarDialog-amountCustom"},t?Object(c.b)("div",{className:"Reward-TipjarDialog-amountInput"},Object(c.b)("input",{name:"",type:"text",className:"SimpleInput",placeholder:"你想赞赏的金额（不超过 500）",value:n,onChange:this.handleCustomChange,onKeyUp:this.handleCustomKeyUp,ref:function(e){e&&e.focus()}}),Object(c.b)(h.c,{disabled:n<=0||n>500,color:"blue",preset:"primary",onClick:this.handleSubmitCustom},"确定"),Object(c.b)("div",{className:"Reward-TipjarDialog-error",style:{display:n>500?"block":"none"}},"不能超过 500 元")):Object(c.b)(h.c,{preset:"plain",className:a?"TipjarDialog-customButton-cheked":"TipjarDialog-customButton",onClick:this.handleCustomAmount},a?"自定义金额： ￥ ".concat(o/U):"自定义金额"))}},{key:"renderTipjarDialog",value:function(){var e=this,t=this.props,n=t.author,o=n.name,a=n.avatarUrl,i=n.isOrg,r=n.urlToken,s=n.id,l=t.tagline,m=this.state.currentAmount;return Object(c.b)("div",{className:"Reward-TipjarDialog"},Object(c.b)("div",{className:"Reward-TipjarDialog-user"},Object(c.b)("a",{href:"/".concat(i?"org":"people","/").concat(r||s),className:"Reward-UserAvatar"},Object(c.b)("img",{src:a.replace("_is","_l"),className:"Reward-Avatar",alt:"当前用户"})),o),Object(c.b)("div",{className:"Reward-TipjarDialog-tagLine"},l),Object(c.b)("div",{className:"Reward-TipjarDialog-selectAmount"},Object(c.b)("div",{className:"Reward-TipjarDialog-amountList"},z.map(function(t){return Object(c.b)(h.c,{key:t,"data-amount":t,onClick:e.handleAmountButton,color:"red",className:b()({"Reward-Button-checked":Number(m)===t})},Object(c.b)("b",null,Number(m)===t?"".concat(t/U," 元"):"￥ ".concat(t/U)))})),this.renderAmountCustom()))}},{key:"render",value:function(){var e=this.props,t=e.ua,n=e.TipjarRender,o=e.isMobile,a=e.tradeNumber,i=e.balanceEnable,r=this.state,s=r.showCustom,l=r.tradeLoading,m=r.showTipModal,u=r.trade,d=r.chosePaymentName,p=o?v.a:f.b,b=o?"small":"default";return Object(c.b)(p,{overlay:!0,size:b,onClose:this.colseTijarDialog,className:"Reward-TipjarDialogModal"},n&&Object(c.b)("div",null,m&&d&&this.renderTipjarDialog(),(u||l)&&!s&&Object(c.b)(B,{trade:u,tradeNumber:a,ua:t,onSuccess:this.onPaySuccess,onConfirmPayment:this.onConfirmPayment,balanceEnable:i})))}}]),t}(l.Component);_.propTypes={author:d.a.object,tagline:d.a.string,colseTijarDialog:d.a.func,addReward:d.a.func,tradeNumber:d.a.number,removeTradeNumber:d.a.func,onPaySuccess:d.a.func,isMobile:d.a.bool,type:d.a.string,balanceEnable:d.a.bool},_.defaultProps={tagline:q.i,balanceEnable:!0}},2412:function(e,t,n){"use strict";n.r(t);var o=n(16),a=n(25),i=n(4),r=n(8),s=n(7),c=n(5),l=n(6),m=n(0),u=n(2),d=n.n(u),p=n(1),b=n.n(p),h=n(12),f=n(13),v=n.n(f),C=n(138),O=n(11),j=n(110),g=n.n(j),y=n(2254),k=n(137),I=n(65),N=n(2282),w=n(9),R=n(42),S=n(165),P=n(24),T=n(80),D=n(131),L=n(205),F=n(598),x=n(597),B=n(2273),E=n(589),M=n(2283);n(2309);function A(e,t){switch(e){case"answer":return Object(T.c)(t);case"article":return Object(D.b)(t);default:return null}}var q=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return(n=Object(s.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).state={collapsed:!0,current:1},n.commentsWithPaginationElRef=b.a.createRef(),n.load=function(e,t,o){if(!n.props.isFetching&&!n.props.parent.adminClosedComment){var a=e||n.props,i=a.order,r=a.byComment,s=a.status,c=a.parent,l=c.id,m=c.type,u=a.dispatch,d=a.commentPattern;if(a.needLoadCommentPermission&&A(m,l)&&u(A(m,l)),o){u(Object(C.e)(m,l,{order:i,isPrevious:t,byComment:r,status:"collapsed",commentPattern:d},!0))}else u(Object(C.e)(m,l,{order:i,isPrevious:t,byComment:r,status:s,commentPattern:d}))}},n.addComment=function(e,t){var o=n.props,a=o.parent,i=a.id,r=a.type,s=o.dispatch,c=[r,i,e];return t&&(c[3]=t.id),s(C.a.apply(void 0,c))},n.featureItem=function(e){n.props.onItemFeature(e,n.lastFeaturedIndex)},n.handleOpenCollapsed=function(){n.setState({collapsed:!1}),n.load(n.props,!1,!0)},n.createOnRef=g()(function(e){return function(t){var o=n.props.byComment;e===Number(o)&&(n.targetCommentEl=t)}}),n.handlePageSelect=function(e){var t=n.props.onPaginationClick,o=n.state.current;t&&t(o,e),n.commentsElement.scrollIntoView(),n.setState({current:e}),n.loadByPagination(e)},n.loadByPagination=function(e,t){var o=t||n.props,a=o.order,i=o.byComment,r=o.status,s=o.parent,c=s.id,l=s.type,m=o.dispatch,u=o.commentPattern;o.needLoadCommentPermission&&A(l,c)&&m(A(l,c)),m(Object(C.e)(l,c,{order:a,isPrevious:!1,byComment:i,status:r,commentPattern:u,current:e}))},n.renderComment=function(e){var t=n.props,o=t.parent,a=o.type,i=o.author,r=(i=void 0===i?{isOrg:!1}:i).isOrg,s=t.isMobile,c=t.parent,l=t.commentNeedsReview,u=t.onShowConversation,d=t.status,p=t.onItemLike,b=t.onItemDelete,h=t.onItemCollapse,f=t.onItemDislike,v=t.onItemApprove,C=t.canOperateItem,O=t.commentPattern;return Object(m.b)(x.a,{key:e.id,isMobile:s,comment:e,onRef:n.createOnRef(e.id),status:d,type:a,parent:c,canOperate:C,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:r,onLike:p,onReply:n.addComment,onFeature:n.featureItem,onDelete:b,onCollapse:h,onDislike:f,onApprove:v,commentPattern:O})},n.renderNormalComments=function(e){var t=n.state.collapsed,o=n.props.byComment,a=[];if(n.lastFeaturedIndex=0,e.length>0){var i=e[0].featured,r=!1;e.forEach(function(s,c){if(o||!s.collapsed){var l=e[c-1];if(!s.collapsed||(l&&l.collapsed||a.push(n.renderCollapsedDivider()),!t)){a.push(n.renderComment(s));var u=e[c+1];i&&!r&&s.featured&&(!u||!u.featured)&&(r=!0,n.lastFeaturedIndex=c,a.push(Object(m.b)("div",{className:"CommentList-divider",key:"divider-featured"},Object(m.b)("div",{className:"CommentList-dividerLine"}),Object(m.b)("div",{className:"CommentList-dividerText"},"以上为精选评论",Object(m.b)(y.a,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}})}return a},n.renderCollapsedComments=function(){var e=[],t=n.props.collapsedComments;return n.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return n.renderComment(e)})),e)},n.renderComments=function(e){return e.map(n.renderComment)},n.renderCollapsedDivider=function(){var e=n.props,t=e.isDrained,o=e.parent.collapsedCounts;return!t||o<=0?[]:n.state.collapsed?Object(m.b)("div",{className:"CommentList-action",key:"collapsed"},Object(m.b)("div",{className:"CommentList-expendCollapseButton"},Object(m.b)("span",{onClick:n.handleOpenCollapsed},Object(R.formatNumber)(o)," 条评论被折叠"),"（",Object(m.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):Object(m.b)("div",{className:"CommentList-divider",key:"divider-collapsed"},Object(m.b)("div",{className:"CommentList-dividerLine"}),Object(m.b)("div",{className:"CommentList-dividerText"},Object(R.formatNumber)(o)," 条评论被折叠（",Object(m.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},n.renderCollapsedInfiLoader=function(){var e=n.state.collapsed;if(e)return[];var t=n.props.collapsedInfo,o=(t=void 0===t?{}:t).isFetching,a=t.isPrevDrained,i=t.isDrained;return Object(m.b)(I.b,{className:"CommentList",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:o,isPrevDrained:a,isDrained:i,onLoad:function(t){return n.load(n.props,t,!e)},placeholder:Object(m.b)(I.a,{className:"CommentItem",small:!0})},n.renderCollapsedComments())},n.renderPatternContent=function(e){var t=n.props,o=t.isFetching,a=t.parent.adminClosedComment,i=t.byComment,r=t.status,s=t.order,c=t.totals,l=t.showPackupButton,u=t.handlePackupButton,d=Math.ceil(c/20),p=n.state.current;return a?null:o?Object(m.b)(B.a,null):Object(m.b)("div",{ref:n.commentsWithPaginationElRef},Object(m.b)("div",{className:"CommentList"},"normal"===s&&"open"===r?n.renderNormalComments(e):n.renderComments(e)),d>1&&Object(m.b)(N.a,{className:"comments-pagination",current:p,total:d,onSelect:n.handlePageSelect}),!i&&n.renderCollapsedDivider(),!i&&n.renderCollapsedInfiLoader(),l&&Object(m.b)(M.a,{onClick:u,commentsElRef:n.commentsWithPaginationElRef}))},n.renderModalContent=function(e){var t=n.props,a=t.collapsedInfo,i=t.parent.adminClosedComment,r=t.status,s=t.order,c=t.byComment,l=n.state.collapsed,u=l?n.props:a,d=u.isFetching,p=u.isDrained,b=u.isPrevDrained;if(p&&e.length<=0||i)return Object(m.b)("div",{className:"Comments-empty"},Object(m.b)(L.d,null,Object(m.b)(L.a,null),Object(m.b)("div",null,"还没有评论")));var h={getContainer:function(e){return e}};return Object(m.b)(I.b,Object(o.default)({className:"CommentList",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:d,isPrevDrained:b,isDrained:p,onLoad:function(e){return n.load(n.props,e,!l)},placeholder:Object(m.b)(I.a,{className:"CommentItem",small:!0})},h),"normal"===s&&"open"===r?n.renderNormalComments(e):n.renderComments(e),!c&&n.renderCollapsedDivider(),!c&&n.renderCollapsedComments())},n.renderCommentEdit=function(e){var t=n.props,a=t.parent,i=a.canComment,r=(i=void 0===i?{status:!0}:i).status,s=i.reason,c=a.author,l=(c=void 0===c?{isOrg:!1}:c).isOrg,u=a.type,d=a.id,p=a.adminClosedComment,b=a.questionType,h=t.byComment,f=t.autoFocus,C=t.commentNeedsReview,j=p?"当前内容暂时无法评论":s,g=f&&!h;return r&&!p?Object(m.b)(F.a,Object(o.default)({className:"Comments-".concat("top"===e?"top":"footer"),type:u,id:d,commentNeedsReview:C,onSubmit:n.addComment,autoFocus:g,ownerAuthorIsOrg:l,ownerAuthorIsBrand:"commercial"===b},"top"===e&&{preset:"default",onClick:function(e){O.default.trackEvent(e.target,{id:3905})}})):"top"!==e&&Object(m.b)("div",{className:v()("Comments-disabledText",{"Comments-disabledText--fixed":void 0})},Object(m.b)("div",{className:"Comments-disabledReason"},j))},n.renderBottomButton=function(){var e=n.props.params,t=e.id,o=e.answerId,a=Boolean(o);return Object(m.b)("div",{className:"Comments-footer CommentEditor--normal"},Object(m.b)(w.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(){return Object(k.b)(Object(S.a)(a?{type:"answer",id:o}:{type:"question",id:t},{utm_content:"comment_area"}),{zaProps:{id:3906}})}},"打开 App 参与站内讨论"))},n}return Object(l.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,a=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||this.loadByPagination(a)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,i=t.commentPattern;n===e.order&&o===e.status||("bottom"===i?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var r=e.targetComment;!a&&r&&this.setState({collapsed:!r.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(P.d)(P.b))}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,a=n.height,i=t.getBoundingClientRect(),r=i.top,s=i.height;this.listEl.scrollTop+=o-r-(s-a)/2,e.classList.add("CommentItem--highlighted"),setTimeout(function(){return e.classList.remove("CommentItem--highlighted")},2e3),e.tabIndex=-1,e.focus()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.isAuthor,i=t.comments,r=t.commentPattern,s=t.commentInputPosition,c=t.parent,l=c.author,u=(l=void 0===l?{isOrg:!1}:l).isOrg,d=c.commentPermission,p=c.reviewingCounts,b=c.commentCount,h=c.adminClosedComment,f=t.totals,C=t.status,O=t.order,j=t.onStatusChange,g=t.onOrderChange,y=t.targetLink,k=i.filter(function(e){return!e.isDelete}),I="censor"===d&&a,N=I?{isCommentReviewer:I,onStatusChange:j,status:C,reviewingCounts:p}:{status:C},w=v()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===r},n);return Object(m.b)("div",{className:w,ref:function(t){e.commentsElement=t}},Object(m.b)(E.a,Object(o.default)({commentCount:void 0!==b?b:f,commentClosed:h,targetLink:y,order:O,onOrderChange:g,commentPattern:r,isOrg:u,options:this.renderCommentEdit("top")},N)),"top"===s&&this.renderCommentEdit(),"bottom"===r?this.renderPatternContent(k):this.renderModalContent(k),"bottom"===s&&this.renderCommentEdit())}}]),t}(p.Component);q.propTypes={type:d.a.string,parent:d.a.object.isRequired,targetLink:d.a.node,commentNeedsReview:d.a.bool,byComment:d.a.oneOfType([d.a.number,d.a.string]),commentPattern:d.a.string,commentInputPosition:d.a.oneOf(["top","bottom"]),showPackupButton:d.a.bool,handlePackupButton:d.a.func,onPaginationClick:d.a.func,autoFocus:d.a.bool},q.contextTypes={authRequired:d.a.func.isRequired},q.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0};var z=Object(h.connect)(function(e,t){var n=t.parent,o=t.parent,a=o.type,i=o.id,r=t.status,s=t.order,c=t.byComment,l=t.commentPattern,m=e.entities,u=e.comments,d="".concat(a,"_").concat(i),p=u.parent,b=u.pagination;"reviewing"===r&&(b=u.reviewing),"reverse"===s&&"open"===r&&(b=u.reverse);var h=[],f=u.collapsed[d]||{};f.ids&&f.ids.length>0&&(h=f.ids.map(function(e){return m.comments[e]}));var v=b[d]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},C=v.isFetching,O=v.isPrevDrained,j=v.isDrained,g=v.ids,y=v.newIds,k=void 0===y?[]:y;return{isFetching:C,isPrevDrained:O,isDrained:j,totals:v.totals,comments:("bottom"!==l?g:k).map(function(e){return m.comments[e]}),collapsedInfo:f,collapsedComments:h,targetComment:m.comments[c],parent:Object.assign({},n,{},p[d])}})(q),U=n(32),_=n(36);var V=function(e){function t(e,n){var o;return Object(i.a)(this,t),(o=Object(s.a)(this,Object(c.a)(t).call(this,e,n))).load=o.load.bind(Object(U.default)(o)),o.addComment=n.authRequired(o.addComment.bind(Object(U.default)(o)),void 0,P.b),o}return Object(l.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(C.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,a=o.type,i=o.id,r=n.commentId,s=n.dispatch,c=[a,i,e,t.id,r];return s(C.a.apply(void 0,c))}},{key:"render",value:function(){var e,t,n,o=this.props,a=o.onItemLike,i=o.onItemDelete,r=o.onItemFeature,s=o.onItemApprove,c=o.onItemCollapse,l=o.onItemDislike,u=o.onNavBack,d=o.canOperateItem,p=o.isFetching,b=o.comments,h=o.commentNeedsReview,f=o.openComment.collapsed,v=o.parent,C=o.parent.canComment,O=(C=void 0===C?{status:!0}:C).status,j=C.reason,g=o.commentPattern,y=o.commentId,k=this.context.currentUser;return Boolean(k&&b.find(function(e){return e.author&&e.author.member.urlToken===k.urlToken}))&&(t=(e=b.filter(function(e){return e.author&&e.author.member.urlToken!==k.urlToken}))[e.length-1]),p&&!b.length?n=Object(m.b)(I.a,{className:"CommentItem",small:!0}):b.length&&(n=b.map(function(e,t){return Object(m.b)(x.a,{key:t,isConversation:!0,commentNeedsReview:h,canOperate:d,parent:v,comment:e,onLike:a,onDelete:i,onFeature:r,onApprove:s,onCollapse:c,onDislike:l,collapsedShown:f})})),"bottom"===g?Object(m.b)(_.b,{size:"fullPage",onClose:u},Object(m.b)("div",{className:"Comments"},Object(m.b)(E.a,{isConversation:!0,commentPattern:g}),Object(m.b)("div",{className:"CommentList"},n))):Object(m.b)("div",{className:"Comments"},Object(m.b)(E.a,{isConversation:!0,onNavBack:u}),Object(m.b)("div",{className:"CommentList"},n),t&&(O?Object(m.b)(F.a,{id:y,type:"conversation",className:"Comments-footer",replyTo:t,commentNeedsReview:h,onSubmit:this.addComment}):Object(m.b)("div",{className:"Comments-disabledText"},j)))}}]),t}(p.Component);V.propTypes={commentId:d.a.number.isRequired,type:d.a.string,parent:d.a.object.isRequired,commentNeedsReview:d.a.bool},V.contextTypes={currentUser:d.a.object,authRequired:d.a.func.isRequired};var W,H,G,K=Object(h.connect)(function(e,t){var n=t.commentId,o=e.entities.comments,a=e.comments.conversation[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:a.isFetching,isDrained:a.isDrained,comments:a.ids.map(function(e){return o[e]}),openComment:o[n]}})(V),J=n(71),Z=Object(J.a)(null)((G=H=function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).state={openedCommentId:null,status:"open",order:"normal"},n.like=function(e,t){var o=n.props,a=o.onItemLike,i=o.dispatch;a&&a(e,t),i(Object(C.j)(e))},n.collapse=function(e){var t=n.props,o=t.dispatch,a=t.parent;o(Object(C.g)(e,a.type,a.id))},n.dislike=function(e){return n.props.dispatch(Object(C.h)(e))},n.approve=function(e){var t=n.props,o=t.dispatch,a=t.parent,i=t.type;o(Object(C.b)(e,a.type||i,a.id))},n.handleStatusChange=function(e){n.setState({status:e})},n.handleOrderChange=function(e,t){n.props.onOrderChange&&n.props.onOrderChange(e,t),n.setState({order:e})};var o=e.parent,a=e.dispatch;return n.feature=function(e,t){return a(Object(C.i)(e,o.id,o.type,t))},n.delete=function(e){return a(Object(C.d)(e,o.type,o.id))},n.showConversation=function(e){return n.setState({openedCommentId:e})},n.showComments=function(){return n.setState({openedCommentId:null})},n}return Object(l.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,i=t.containerClassName,r=t.parent,s=t.commentPattern,c=t.type,l=t.parent,u=(l=void 0===l?{}:l).commentPermission,d=l.relationship,p=void 0===d?{}:d,b=l.author,h=void 0===b?{}:b,f=t.needLoadCommentPermission,C=Object(a.a)(t,["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"]),O=this.context.currentUser,j=void 0===p.isAuthor?O&&h.urlToken&&O.urlToken===h.urlToken:p.isAuthor,g="censor"===u&&!j,y="answer"===c||"article"===c,k=this.state,I=k.openedCommentId,N=k.status,w=k.order,R={commentNeedsReview:g,parent:r,type:c,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return Object(m.b)("div",{className:v()("Comments-container",i),ref:function(t){return e.domNode=t}},Object(m.b)(z,Object(o.default)({},C,R,{commentPattern:s,className:v()(n,{"Comments--hidden":I&&"bottom"!==s}),order:w,status:N,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:f,isAuthor:j})),I&&Object(m.b)(K,Object(o.default)({},C,R,{commentPattern:s,commentId:I,onNavBack:this.showComments})))}}]),t}(p.Component),H.propTypes={type:d.a.string.isRequired,parent:d.a.object.isRequired,onOrderChange:d.a.func,onItemLike:d.a.func,isAuthor:d.a.bool,onMount:d.a.func},H.defaultProps={type:"answer"},H.contextTypes={currentUser:d.a.object,authRequired:d.a.func.isRequired},W=G))||W;t.default=Object(h.connect)()(Z)}}]);
//# sourceMappingURL=column.modals.fc031e63571c59a949fe.js.map